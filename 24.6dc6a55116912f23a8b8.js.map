{"version":3,"sources":["./src/app/timesheet-modules/user-timesheet-week/user-timesheet-week/user-timesheet-card-dialog-wrapper.component.ts","./src/app/shared-app/helpers/datetime/get-weeks-in-year.helper.ts","./src/app/timesheet-modules/user-timesheet-week/user-timesheet-week/component.reducers.ts","./src/app/timesheet-modules/user-timesheet-week/user-timesheet-week/user-timesheet-week.facade.ts","./src/app/shared-app/helpers/object/map-objects-to-weekdays.helper.ts","./src/app/timesheet-modules/user-timesheet-week/user-timesheet-week/user-timesheet-week-providers.const.ts","./src/app/shared/pipes/is-today.pipe.ts","./src/app/timesheet-modules/user-timesheet-week/user-timesheet-week/timesheet-day-label/timesheet-day-label.component.html","./src/app/timesheet-modules/user-timesheet-week/user-timesheet-week/timesheet-day-label/timesheet-day-label.component.ts","./src/app/timesheet-modules/user-timesheet-week/user-timesheet-week/timesheet-mission-bar/timesheet-mission-bar.component.html","./src/app/timesheet-modules/user-timesheet-week/user-timesheet-week/timesheet-mission-bar/timesheet-mission-bar.component.ts","./src/app/timesheet-modules/shared-timesheet/pipes/get-date-by-date-params.pipe.ts","./src/app/timesheet-modules/user-timesheet-week/user-timesheet-week/user-timesheet-week-view/user-timesheet-week-view.component.html","./src/app/timesheet-modules/user-timesheet-week/user-timesheet-week/user-timesheet-week-view/user-timesheet-week-view.component.ts","./src/app/timesheet-modules/user-timesheet-week/user-timesheet-week-routing.module.ts","./src/app/timesheet-modules/user-timesheet-week/user-timesheet-week/user-timesheet-week.component.ts","./src/app/timesheet-modules/user-timesheet-week/user-timesheet-week/user-timesheet-week.component.html","./src/app/timesheet-modules/user-timesheet-week/user-timesheet-week.module.ts"],"names":["store","timesheetId","timesheet$","this","select$","pipe","map","state","timesheet","userTimesheets","mission","missions","missionId","UserTimesheetCardDialogWrapperComponent","_getWeeksInYear","year","d","Date","isLeap","getMonth","getDay","SetTimesheetCriteriaActionId","SetTimesheetCriteriaReducer","actionId","reducerFn","action","timesheetCriteria","weekCriteria","NextWeekActionId","NextWeekReducer","stateProperties","weekNr","PreviousWeekActionId","PreviousWeekReducer","summaryAggregator","componentStore","currentWeekNr","currentYear","getFullYear","weekCriteria$","selectProperty$","filteredTimesheets$","combineLatest","x","records","weekDaySummaries$","relationCfg","timesheets","objects","dateProp","result","i","length","obj","_mapObjectsToWeekdays","groupByType","Day","previousWeek","dispatch","nextWeek","currYear","currWeekNr","updateCriteria","selectProperty","UserTimesheetWeekFacade","DefaultWeekCriteria","DefaultComponentState","UserTimesheetWeekProviders","provide","useValue","multi","transform","value","today","date","getDate","IsTodayPipe","dialog","labelClicked","TimesheetDayLabelComponent","barClicked","clickBar","emit","TimesheetMissionBarComponent","dp","weekDayOverride","Object","keys","weekDay","setDate","GetDateByDateParamsPipe","timesheetClicked","trackByTimesheet","UserTimesheetWeekViewComponent","routes","path","component","router","route","deviceInfoService","facade","modelFormService","formService","navConfig$","getNavConfig","vm$","isXs$","isXs","weekDaySummaries","openTimesheetForm","entityId","form","dynamicForm","disabledControls","open","formConfig","initialValue","adapter","stateProp","openTimesheetCard","data","panelClass","goToTimesheetList","navigate","criteria","JSON","stringify","dateRange","relativeTo","openWeekFilter","user","noRenderDisabledControls","navConfig","title","submitCallback","val","subTitle","toString","buttons","icon","color","callback","UserTimesheetWeekComponent","child","children","loadChildren","then","m","UserTimesheetListModule","UserTimesheetWeekRoutingModule","forChild","UserTimesheetWeekModule"],"mappings":"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","file":"24.6dc6a55116912f23a8b8.js","sourcesContent":["import { ChangeDetectionStrategy, Component, Inject } from '@angular/core';\r\nimport { MAT_DIALOG_DATA } from '@angular/material/dialog';\r\nimport { map } from 'rxjs/operators';\r\nimport { _find } from 'src/app/shared-app/helpers/array/find.helper';\r\nimport { Store } from 'src/app/state/store';\r\nimport { StoreState } from '../store-state.interface';\r\nimport { UserTimesheetWeekFacade } from './user-timesheet-week.facade';\r\n\r\n@Component({\r\n  selector: 'app-timesheet-card-dialog-wrapper',\r\n  template: `\r\n  <app-timesheet-card \r\n    [timesheet]=\"timesheet$ | async\">\r\n  </app-timesheet-card>\r\n  `,\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\n\r\nexport class UserTimesheetCardDialogWrapperComponent {\r\n\r\n  timesheet$ = \r\n    this.store.select$([\"userTimesheets\", \"missions\"], false).pipe(map(state => {\r\n        const timesheet = _find(state.userTimesheets, this.timesheetId, \"id\");\r\n        if(!timesheet) return null;\r\n        timesheet.mission = _find(state.missions, timesheet.missionId, \"id\");\r\n        return timesheet;\r\n    }))\r\n\r\n  constructor(\r\n    private store: Store<StoreState>,\r\n    @Inject(MAT_DIALOG_DATA) public timesheetId: string\r\n  ) {}\r\n  \r\n}\r\n","export function _getWeeksInYear(year: number): number{\r\n  let d = new Date(year, 0, 1);\r\n  let isLeap = new Date(year, 1, 29).getMonth() === 1;\r\n\r\n  //check for a Jan 1 that's a Thursday or a leap year that has a \r\n  //Wednesday jan 1. Otherwise it's 52\r\n  return d.getDay() === 4 || isLeap && d.getDay() === 3 ? 53 : 52\r\n}","import { StoreState } from 'src/app/core/services/auth/interfaces/store-state';\r\nimport { _getWeeksInYear } from 'src/app/shared-app/helpers/datetime/get-weeks-in-year.helper';\r\nimport { StateAction, Reducer } from 'src/app/state/interfaces';\r\nimport { WeekCriteria } from '../../shared-timesheet/interfaces';\r\nimport { WeekToTimesheetCriteriaAdapter } from '../../shared-timesheet/timesheet-filter/week-to-timesheet-criteria.adapter';\r\nimport { ComponentStoreState } from '../store-state.interface';\r\n\r\nexport const SetTimesheetCriteriaActionId = \"SET_TIMESHEET_CRITERIA\";\r\n\r\nexport interface SetTimesheetCriteriaCommand extends StateAction { weekCriteria: WeekCriteria }\r\n\r\nexport const SetTimesheetCriteriaReducer: Reducer<any> = {\r\n    actionId: SetTimesheetCriteriaActionId,\r\n    reducerFn: (state: StoreState, action: SetTimesheetCriteriaCommand) => {\r\n        return {\r\n            timesheetCriteria: new WeekToTimesheetCriteriaAdapter(action.weekCriteria),\r\n            weekCriteria: action.weekCriteria\r\n        }\r\n    }       \r\n} \r\n\r\nexport const NextWeekActionId = \"NEXT_WEEK\";\r\nexport interface NextWeekCommand extends StateAction { currYear: number, currWeekNr: number }\r\n\r\nexport const NextWeekReducer: Reducer<any> = {\r\n    actionId: NextWeekActionId,\r\n    stateProperties: [\"weekCriteria\"], //Ingen state trengs\r\n    reducerFn: (state: ComponentStoreState, action: NextWeekCommand) => {\r\n        const {currYear, currWeekNr} = action; \r\n        if(state.weekCriteria.year >= currYear &&state. weekCriteria.weekNr >= currWeekNr) return;\r\n    \r\n        if(state.weekCriteria.weekNr >= _getWeeksInYear(state.weekCriteria.year)){   \r\n            state.weekCriteria.year++; //New year if week nr is over total weeks for year\r\n            state.weekCriteria.weekNr = 1; //Start of new year     \r\n        }\r\n        else state.weekCriteria.weekNr++;\r\n      \r\n        return {\r\n            timesheetCriteria: new WeekToTimesheetCriteriaAdapter(state.weekCriteria),\r\n            weekCriteria: state.weekCriteria\r\n        }\r\n    }       \r\n}  \r\n\r\nexport const PreviousWeekActionId = \"PREVIOUS_WEEK\";\r\n\r\nexport const PreviousWeekReducer: Reducer<any> = {\r\n    actionId: PreviousWeekActionId,\r\n    stateProperties: [\"weekCriteria\"], //Ingen state trengs\r\n    reducerFn: (state: ComponentStoreState, action: StateAction) => {\r\n        const {weekCriteria} = state;\r\n        \r\n        if(weekCriteria.weekNr <= 1) {\r\n            weekCriteria.year--; //Go to previous year if new week is less than 1\r\n            weekCriteria.weekNr = _getWeeksInYear(weekCriteria.year); //Set to max week in previous year\r\n        }\r\n        else weekCriteria.weekNr--;  \r\n\r\n        return {\r\n            timesheetCriteria: new WeekToTimesheetCriteriaAdapter(weekCriteria),\r\n            weekCriteria\r\n        }\r\n    }       \r\n}  ","import { Injectable } from '@angular/core';\r\nimport { combineLatest, Observable } from 'rxjs';\r\nimport { map, tap } from 'rxjs/operators';\r\nimport { Mission, Timesheet } from 'src/app/core/models';\r\nimport { _getRangeWithRelations } from 'src/app/model/helpers/get-range-with-relations.helper';\r\nimport { GetWithRelationsConfig } from 'src/app/model/helpers/get-with-relations.config';\r\nimport { _find } from 'src/app/shared-app/helpers/array/find.helper';\r\nimport { _getWeekOfYear } from 'src/app/shared-app/helpers/datetime/get-week-of-year.helper';\r\nimport { _mapObjectsToWeekdays } from 'src/app/shared-app/helpers/object/map-objects-to-weekdays.helper';\r\nimport { GroupByPeriod } from 'src/app/shared/enums';\r\nimport { filterRecords } from 'src/app/shared/operators/filter-records.operator';\r\nimport { ComponentStore } from 'src/app/state/component.store';\r\nimport { Store } from 'src/app/state/store';\r\nimport { TimesheetSummary } from '../../shared-timesheet/interfaces';\r\nimport { WeekCriteria } from '../../shared-timesheet/interfaces/week-criteria.interface';\r\nimport { TimesheetSummaryAggregator } from '../../shared-timesheet/services/timesheet-summary.aggregator';\r\nimport { TimesheetCriteria } from '../../shared-timesheet/timesheet-filter/timesheet-criteria.interface';\r\nimport { TimesheetFilter } from '../../shared-timesheet/timesheet-filter/timesheet-filter.model';\r\nimport { ComponentStoreState, StoreState } from '../store-state.interface';\r\nimport { NextWeekActionId, PreviousWeekActionId, SetTimesheetCriteriaActionId } from './component.reducers';\r\n\r\n@Injectable()\r\nexport class UserTimesheetWeekFacade {\r\n\r\n    private currentWeekNr: number = _getWeekOfYear();\r\n    private currentYear: number = new Date().getFullYear();\r\n\r\n    get weekCriteria(){ return this.componentStore.selectProperty<WeekCriteria>(\"weekCriteria\"); } \r\n    weekCriteria$ = this.componentStore.selectProperty$<WeekCriteria>(\"weekCriteria\");\r\n\r\n    private filteredTimesheets$: Observable<Timesheet[]> = combineLatest([\r\n        this.store.selectProperty$<Timesheet[]>(\"userTimesheets\"),\r\n        this.componentStore.selectProperty$<TimesheetCriteria>(\"timesheetCriteria\")\r\n    ]).pipe(filterRecords(TimesheetFilter), map(x => x.records));\r\n\r\n    weekDaySummaries$: Observable<{ [key: number]: TimesheetSummary }> = combineLatest([\r\n        this.filteredTimesheets$, \r\n        this.store.selectProperty$<Mission[]>(\"missions\")\r\n    ]).pipe(\r\n        map(([userTimesheets, missions]) =>  {\r\n            const relationCfg = new GetWithRelationsConfig(\"userTimesheets\", null, [\"missions\"]);\r\n            const timesheets = _getRangeWithRelations({userTimesheets, missions}, relationCfg);\r\n            const summaries = this.summaryAggregator.groupByType(GroupByPeriod.Day, timesheets);\r\n            return _mapObjectsToWeekdays(summaries, \"date\")\r\n        })\r\n    );\r\n    \r\n    constructor(\r\n        private summaryAggregator: TimesheetSummaryAggregator,\r\n        private store: Store<StoreState>,\r\n        private componentStore: ComponentStore<ComponentStoreState>,  \r\n    ){}\r\n     \r\n    previousWeek = (): void =>  \r\n        this.componentStore.dispatch({ actionId: PreviousWeekActionId })\r\n    \r\n    nextWeek = (): void =>       \r\n        this.componentStore.dispatch({ \r\n            actionId: NextWeekActionId, \r\n            currYear: this.currentYear, \r\n            currWeekNr: this.currentWeekNr \r\n        })\r\n\r\n    updateCriteria = (weekCriteria: WeekCriteria) => \r\n        this.componentStore.dispatch({ actionId: SetTimesheetCriteriaActionId, weekCriteria })\r\n}","export function _mapObjectsToWeekdays<TObject>(objects: TObject[], dateProp: string): { [key: number]: TObject }{\r\n  if(!objects) return;\r\n  const result: { [key: number]: TObject } = {};\r\n  for(let i = 0; i < objects.length; i++){\r\n    const obj = objects[i];\r\n    result[new Date(obj[dateProp]).getDay() || 7] = obj;\r\n  }\r\n  return result;\r\n}","import { Provider } from '@angular/core';\r\nimport { _getWeekOfYear } from 'src/app/shared-app/helpers/datetime/get-week-of-year.helper';\r\nimport { STORE_DEFAULT_STATE, STORE_REDUCERS } from 'src/app/state/injection-tokens';\r\nimport { ComponentStoreProviders } from 'src/app/state/providers.const';\r\nimport { WeekCriteria } from '../../shared-timesheet/interfaces';\r\nimport { WeekToTimesheetCriteriaAdapter } from '../../shared-timesheet/timesheet-filter/week-to-timesheet-criteria.adapter';\r\nimport { ComponentStoreState } from '../store-state.interface';\r\nimport { NextWeekReducer, PreviousWeekReducer, SetTimesheetCriteriaReducer } from './component.reducers';\r\nimport { UserTimesheetWeekFacade } from './user-timesheet-week.facade';\r\n\r\nconst DefaultWeekCriteria: WeekCriteria= {\r\n    year: new Date().getFullYear(), \r\n    weekNr: _getWeekOfYear(),\r\n}\r\n\r\nconst DefaultComponentState: Partial<ComponentStoreState> = {\r\n    weekCriteria: DefaultWeekCriteria,\r\n    timesheetCriteria: new WeekToTimesheetCriteriaAdapter(DefaultWeekCriteria)\r\n}\r\n\r\nexport const UserTimesheetWeekProviders: Provider[] = [\r\n    ...ComponentStoreProviders,\r\n    UserTimesheetWeekFacade,\r\n    { provide: STORE_REDUCERS, useValue: SetTimesheetCriteriaReducer, multi: true },\r\n    { provide: STORE_REDUCERS, useValue: NextWeekReducer, multi: true },\r\n    { provide: STORE_REDUCERS, useValue: PreviousWeekReducer, multi: true },\r\n    { provide: STORE_DEFAULT_STATE, useValue: DefaultComponentState }\r\n\r\n]\r\n","import { Pipe, PipeTransform } from '@angular/core';\r\n\r\n@Pipe({\r\n  name: 'isToday'\r\n})\r\nexport class IsTodayPipe implements PipeTransform {\r\n\r\n  transform(value: Date | string | number): any {\r\n    const today = new Date();\r\n    const date = new Date(value);\r\n    return date.getDate() === today.getDate() &&\r\n        date.getMonth() === today.getMonth() &&\r\n        date.getFullYear() === today.getFullYear()\r\n  }\r\n\r\n}","<span class=\"mat-elevation-z2 pt-2\" fxLayout=\"column\" fxLayoutAlign=\"start center\" matRipple \n  [ngClass]=\"(date | isToday) ? 'accent' : 'foreground-card color-accent'\"\n  (click)=\"labelClicked.emit(date.getTime())\">\n\n    <div fxLayout=\"column\" fxLayoutAlign=\"center center\" *ngIf=\"date\" >\n      <span class=\"mat-h3 m-0 line-height-100\">\n        {{ date | date : 'E' }}\n      </span>\n\n      <span class=\"mat-title m-0 line-height-100\">\n        {{ date | date : 'dd' }}\n      </span>\n\n      <span class=\"mat-small line-height-100\">\n        {{ date | date : 'MMM' }}\n      </span>\n    </div>\n \n    <mat-icon class=\"icon m-1\">add</mat-icon>\n    \n</span>\n\n\n\n\n\n\n","import { Component, Input, Output, EventEmitter, ChangeDetectionStrategy } from '@angular/core';\r\nimport { MatDialog } from '@angular/material/dialog';\r\n\r\n@Component({\r\n  selector: 'app-timesheet-day-label',\r\n  templateUrl: './timesheet-day-label.component.html',\r\n  changeDetection: ChangeDetectionStrategy.OnPush,\r\n})\r\n\r\nexport class TimesheetDayLabelComponent {\r\n\r\n  @Input() date: Date;\r\n  @Output() labelClicked = new EventEmitter();\r\n\r\n  constructor(public dialog: MatDialog) {}\r\n\r\n}\r\n","<ng-container *ngIf=\"timesheet\">\r\n    <div class=\"mission-bar mat-elevation-z1\" fxLayout=\"column\" fxLayoutAlign=\"center center\" \r\n        [style.height.px]=\"(timesheet.totalHours / 10)*300\"\r\n        [ngClass]=\"timesheet.status === 2 ? 'accent' : 'warn'\"\r\n        (click)=\"clickBar()\" matRipple>\r\n\r\n        <span class=\"mat-body-strong\">\r\n            {{ timesheet.totalHours | number : '1.0-1' }}t\r\n        </span>\r\n    </div>\r\n</ng-container>\r\n","import { Component, Input, ChangeDetectionStrategy, Output, EventEmitter } from '@angular/core';\r\nimport { Timesheet } from 'src/app/core/models';\r\n\r\n@Component({\r\n  selector: 'app-timesheet-mission-bar',\r\n  templateUrl: './timesheet-mission-bar.component.html',\r\n  styleUrls: ['./timesheet-mission-bar.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush,\r\n})\r\nexport class TimesheetMissionBarComponent {\r\n  \r\n  @Input() timesheet: Timesheet;\r\n  @Output() barClicked = new EventEmitter();\r\n\r\n  constructor() { }\r\n  \r\n  clickBar(): void { this.barClicked.emit(); }\r\n\r\n}\r\n","import { Pipe, PipeTransform } from '@angular/core';\nimport { _getDateOfWeek } from 'src/app/shared-app/helpers/datetime/get-date-of-week.helper';\nimport { _getFirstDayOfWeek } from 'src/app/shared-app/helpers/datetime/get-first-day-of-week.helper';\nimport { DateParams } from 'src/app/shared-app/interfaces';\n\n@Pipe({\n  name: 'getDateByDateParams'\n})\nexport class GetDateByDateParamsPipe implements PipeTransform {\n  constructor(){}\n\n  transform(dp: DateParams, weekDayOverride: number): Date {\n    if(!dp || Object.keys(dp).length === 0) return new Date();\n    let date = _getFirstDayOfWeek(_getDateOfWeek(dp.weekNr, dp.year));\n    if(weekDayOverride || dp.weekDay)\n      date.setDate(date.getDate() + (weekDayOverride - 1) || dp.weekDay);\n\n    return date;\n  }\n\n}\n","<div style=\"min-height:100%\" fxLayout=\"row\">\r\n\r\n  <ng-container *ngFor=\"let weekDay of (vm.isXs ? 5 : 7) | arrayFromNumber\">\r\n\r\n    <div class=\"w-100\" fxLayout=\"column\" fxLayoutAlign=\"start stretch\">\r\n\r\n      <app-timesheet-day-label class=\"w-100 mb-1\" style=\"z-index:1;position:sticky;top:0\"\r\n        [date]=\"vm.weekCriteria | getDateByDateParams : weekDay\"\r\n        (labelClicked)=\"labelClicked.emit($event)\">\r\n      </app-timesheet-day-label>\r\n\r\n      <ng-container *ngIf=\"vm.weekDaySummaries && vm.weekDaySummaries[weekDay]\">\r\n        <app-timesheet-mission-bar class=\"fadeInDown\" style=\"margin:2px\"\r\n          *ngFor=\"let timesheet of vm.weekDaySummaries[weekDay].timesheets | sortByDate: 'startTime' : 'asc'; trackBy: trackByTimesheet;\"\r\n          [timesheet]=\"timesheet\"\r\n          (barClicked)=\"timesheetClicked.emit(timesheet)\">\r\n        </app-timesheet-mission-bar>\r\n      </ng-container>\r\n\r\n    </div>\r\n\r\n    <mat-divider vertical=\"true\" *ngIf=\"weekDay !== 7\"></mat-divider>\r\n\r\n  </ng-container>\r\n\r\n</div>","import { ChangeDetectionStrategy, Component, EventEmitter, Input, Output } from \"@angular/core\";\r\nimport { Timesheet } from 'src/app/core/models';\r\nimport { _getWeekOfYear } from 'src/app/shared-app/helpers/datetime/get-week-of-year.helper';\r\nimport { _trackByModel } from 'src/app/shared-app/helpers/trackby/track-by-model.helper';\r\nimport { ViewModel } from '../view-model.interface';\r\n\r\n@Component({\r\n  selector: \"app-user-timesheet-week-view\",\r\n  templateUrl: \"./user-timesheet-week-view.component.html\",\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class UserTimesheetWeekViewComponent {\r\n\r\n  @Input() vm: ViewModel;\r\n  \r\n  @Output() timesheetClicked = new EventEmitter<Timesheet>();\r\n  @Output() labelClicked = new EventEmitter<Date>();\r\n\r\n  constructor() {}\r\n    \r\n  trackByTimesheet = _trackByModel(\"timesheets\");\r\n\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { RouterModule, Routes } from '@angular/router';\r\nimport { UserTimesheetWeekComponent } from './user-timesheet-week/user-timesheet-week.component';\r\n\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    component: UserTimesheetWeekComponent,\r\n    data: {child: true},\r\n    children: [\r\n      {\r\n        path: 'liste', data: {child: true},\r\n        loadChildren: () => import('../user-timesheet-list/user-timesheet-list.module').then(m => m.UserTimesheetListModule)\r\n      }\r\n    ]\r\n  },\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forChild(routes)],\r\n  exports: [RouterModule]\r\n})\r\n\r\nexport class UserTimesheetWeekRoutingModule { }\r\n","import { ChangeDetectionStrategy, Component } from \"@angular/core\";\r\nimport { MatDialog } from \"@angular/material/dialog\";\r\nimport { ActivatedRoute, Router } from \"@angular/router\";\r\nimport { combineLatest, Observable } from 'rxjs';\r\nimport { map } from \"rxjs/operators\";\r\nimport { DeviceInfoService } from 'src/app/core/services/device-info.service';\r\nimport { _objectToDisabledObjectMap } from 'src/app/dynamic-forms/helpers/disabled-control-map.helper';\r\nimport { DynamicForm } from 'src/app/dynamic-forms/interfaces';\r\nimport { ModelState } from 'src/app/model/interfaces';\r\nimport { _getDateOfWeek } from 'src/app/shared-app/helpers/datetime/get-date-of-week.helper';\r\nimport { _getWeekOfYear } from 'src/app/shared-app/helpers/datetime/get-week-of-year.helper';\r\nimport { _getWeekRange } from 'src/app/shared-app/helpers/datetime/get-week-range.helper';\r\nimport { _getWeeksInYear } from 'src/app/shared-app/helpers/datetime/get-weeks-in-year.helper';\r\nimport { MainTopNavConfig } from 'src/app/shared/components/main-top-nav-bar/main-top-nav.config';\r\nimport { WeekCriteriaForm } from 'src/app/shared/constants/forms/week-criteria-controls.const';\r\nimport { CreateUserTimesheetForm, EditUserTimesheetForm, TimesheetForm } from 'src/app/shared/constants/model-forms/save-user-timesheet-form.const';\r\nimport { FormService } from 'src/app/shared/form';\r\nimport { ModelFormService, SaveModelFormState } from 'src/app/shared/model-form';\r\nimport { WeekCriteria } from '../../shared-timesheet/interfaces';\r\nimport { UserTimesheetFormToSaveModelAdapter } from '../../shared-timesheet/state/save-user-timesheet/user-timesheet-form-to-save-model.adapter';\r\nimport { UserTimesheetCardDialogWrapperComponent } from './user-timesheet-card-dialog-wrapper.component';\r\nimport { UserTimesheetWeekProviders } from './user-timesheet-week-providers.const';\r\nimport { UserTimesheetWeekFacade } from './user-timesheet-week.facade';\r\nimport { ViewModel } from './view-model.interface';\r\n\r\n@Component({\r\n  selector: \"app-user-timesheet-week\",\r\n  templateUrl: \"./user-timesheet-week.component.html\",\r\n  changeDetection: ChangeDetectionStrategy.OnPush,\r\n  providers: UserTimesheetWeekProviders\r\n})\r\nexport class UserTimesheetWeekComponent {\r\n\r\n  navConfig$: Observable<MainTopNavConfig> = \r\n    this.facade.weekCriteria$.pipe(map(x => this.getNavConfig(x)));\r\n\r\n  vm$: Observable<ViewModel> = combineLatest([\r\n    this.facade.weekDaySummaries$,\r\n    this.deviceInfoService.isXs$\r\n  ]).pipe(\r\n    map(([weekDaySummaries, isXs]) => { return { isXs, weekDaySummaries, weekCriteria: this.facade.weekCriteria }}),\r\n  );\r\n\r\n  constructor(\r\n    private router: Router,\r\n    private route: ActivatedRoute,\r\n    private dialog: MatDialog,\r\n    private deviceInfoService: DeviceInfoService,\r\n    private facade: UserTimesheetWeekFacade,\r\n    private modelFormService: ModelFormService,\r\n    private formService: FormService,\r\n  ) {}\r\n\r\n  nextWeek = (): void => this.facade.nextWeek()\r\n\r\n  previousWeek = (): void => this.facade.previousWeek()\r\n\r\n  openTimesheetForm = (entityId?: string, form?: TimesheetForm): void => {\r\n    let dynamicForm: DynamicForm<TimesheetForm,  SaveModelFormState<Partial<ModelState>>>;\r\n    if(!entityId) dynamicForm = {...CreateUserTimesheetForm, disabledControls: _objectToDisabledObjectMap(form)}\r\n    else dynamicForm = EditUserTimesheetForm\r\n\r\n    this.modelFormService.open<TimesheetForm>({\r\n      formConfig: {\r\n        dynamicForm: {...dynamicForm, initialValue: form}, entityId,\r\n        adapter: UserTimesheetFormToSaveModelAdapter, \r\n        stateProp: \"userTimesheets\",    \r\n      }, \r\n    })\r\n  };\r\n\r\n  openTimesheetCard = (timesheetId: string) =>\r\n    this.dialog.open(UserTimesheetCardDialogWrapperComponent, {\r\n      data: timesheetId, panelClass: 'extended-dialog'});\r\n\r\n  private goToTimesheetList = () => {\r\n      const {weekNr, year} = this.facade.weekCriteria;\r\n      this.router.navigate([\"liste\", { \r\n        criteria: JSON.stringify({\r\n            dateRange: _getWeekRange(_getDateOfWeek(weekNr, year))\r\n        })\r\n      }], {relativeTo: this.route});\r\n  };\r\n\r\n  private openWeekFilter = (): void => { \r\n    this.formService.open<WeekCriteria, any>({\r\n      formConfig: {...WeekCriteriaForm, \r\n        disabledControls: {user: true}, \r\n        noRenderDisabledControls: true,  \r\n        initialValue: this.facade.weekCriteria}, \r\n      navConfig: {title: \"Velg filtre\"},\r\n      submitCallback: (val: WeekCriteria) => this.facade.updateCriteria(val)\r\n    });\r\n  }\r\n\r\n  private getNavConfig(weekCriteria: WeekCriteria): MainTopNavConfig{\r\n    return { \r\n      title:  \"Uke \" + weekCriteria?.weekNr || \"\",\r\n      subTitle: weekCriteria?.year?.toString() || \"\",\r\n      buttons: [  \r\n        {icon: \"filter_list\", color: 'accent', callback: this.openWeekFilter},\r\n        {icon: \"list\", callback: this.goToTimesheetList},\r\n      ]\r\n    }\r\n  }\r\n}\r\n","<app-main-skeleton disableElevation=\"true\" overlayMode=\"true\">\r\n\r\n  <app-main-top-nav-bar navbar [config]=\"navConfig$ | async\" >\r\n  </app-main-top-nav-bar>\r\n\r\n  <app-user-timesheet-week-view [vm]=\"vm$ | async\" style=\"height:100%;display:block\"\r\n    (swiperight)=\"previousWeek()\" \r\n    (swipeleft)=\"nextWeek()\"\r\n    (timesheetClicked)=\"$event?.status === 2 ? openTimesheetCard($event?.id) : openTimesheetForm($event?.id)\"\r\n    (labelClicked)=\"openTimesheetForm(null, {date: $event})\">\r\n  </app-user-timesheet-week-view>\r\n\r\n</app-main-skeleton>\r\n\r\n","import { NgModule } from '@angular/core';\r\nimport { SharedTimesheetModule } from '../shared-timesheet/shared-timesheet.module';\r\nimport { UserTimesheetCardDialogWrapperComponent } from './user-timesheet-week/user-timesheet-card-dialog-wrapper.component';\r\nimport { TimesheetDayLabelComponent } from './user-timesheet-week/timesheet-day-label/timesheet-day-label.component';\r\nimport { TimesheetMissionBarComponent } from './user-timesheet-week/timesheet-mission-bar/timesheet-mission-bar.component';\r\nimport { UserTimesheetWeekComponent } from './user-timesheet-week/user-timesheet-week.component';\r\nimport { UserTimesheetWeekViewComponent } from './user-timesheet-week/user-timesheet-week-view/user-timesheet-week-view.component';\r\nimport { UserTimesheetWeekRoutingModule } from './user-timesheet-week-routing.module';\r\nimport { SaveUserTimesheetProviders } from '../shared-timesheet/state/providers.const';\r\nimport { ModelFormModule } from 'src/app/shared/model-form/model-form.module';\r\nimport { StateModule } from 'src/app/state/state.module';\r\nimport { DeleteModelProviders } from 'src/app/model/state/providers.const';\r\n\r\n@NgModule({\r\n  declarations: [\r\n    UserTimesheetWeekComponent,\r\n    UserTimesheetWeekViewComponent,\r\n    UserTimesheetCardDialogWrapperComponent,\r\n    TimesheetDayLabelComponent,\r\n    TimesheetMissionBarComponent,\r\n  ],\r\n  providers:[\r\n    ...SaveUserTimesheetProviders,\r\n    ...DeleteModelProviders,\r\n  ],\r\n  imports: [\r\n    SharedTimesheetModule,\r\n    ModelFormModule,\r\n    StateModule,\r\n    UserTimesheetWeekRoutingModule\r\n  ]\r\n})\r\nexport class UserTimesheetWeekModule {\r\n  constructor(){}\r\n}\r\n"],"sourceRoot":"webpack:///"}