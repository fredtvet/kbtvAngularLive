(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{O3an:function(e,t,i){"use strict";i.r(t),i.d(t,"TimesheetFormModule",(function(){return M}));var n=i("DUip"),r=i("h/AT"),s=i("TYT/"),o=i("dJ3e"),a=i("9qP0"),m=i("1YJq"),c=i("15JJ"),u=i("xMyE"),l=i("26FU"),d=i("QJY3"),p=i("VnD/"),f=i("Gi3i"),h=i("Valr"),g=i("uLXW"),v=i("eHTH"),b=i("cSbt"),y=i("iYur"),S=i("z17N"),T=i("p+mS"),w=i("Up+3"),P=i("MqYC");function I(e,t){if(1&e&&(s["\u0275\u0275elementStart"](0,"mat-option",17),s["\u0275\u0275text"](1),s["\u0275\u0275elementEnd"]()),2&e){var i=t.$implicit;s["\u0275\u0275property"]("value",i),s["\u0275\u0275advance"](1),s["\u0275\u0275textInterpolate2"](" (",i.id,") ",i.address," ")}}function D(e,t){if(1&e){var i=s["\u0275\u0275getCurrentView"]();s["\u0275\u0275elementStart"](0,"form",1),s["\u0275\u0275elementStart"](1,"mat-form-field"),s["\u0275\u0275element"](2,"input",2),s["\u0275\u0275elementStart"](3,"mat-autocomplete",3,4),s["\u0275\u0275template"](5,I,2,3,"mat-option",5),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](6,"span",6),s["\u0275\u0275elementStart"](7,"label",7),s["\u0275\u0275elementStart"](8,"mat-form-field",8),s["\u0275\u0275element"](9,"input",9),s["\u0275\u0275elementEnd"](),s["\u0275\u0275element"](10,"owl-date-time",10,11),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](12,"label",7),s["\u0275\u0275elementStart"](13,"mat-form-field",8),s["\u0275\u0275element"](14,"input",12),s["\u0275\u0275elementEnd"](),s["\u0275\u0275element"](15,"owl-date-time",13,14),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](17,"mat-form-field"),s["\u0275\u0275element"](18,"textarea",15),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](19,"button",16),s["\u0275\u0275listener"]("click",(function(){return s["\u0275\u0275restoreView"](i),s["\u0275\u0275nextContext"]().onSubmit()})),s["\u0275\u0275text"](20),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"]()}if(2&e){var n=s["\u0275\u0275reference"](4),r=s["\u0275\u0275reference"](11),o=s["\u0275\u0275reference"](16),a=s["\u0275\u0275nextContext"]();s["\u0275\u0275property"]("formGroup",a.timesheetForm),s["\u0275\u0275advance"](2),s["\u0275\u0275property"]("matAutocomplete",n),s["\u0275\u0275advance"](1),s["\u0275\u0275property"]("displayWith",a.displayMissionAddress),s["\u0275\u0275advance"](2),s["\u0275\u0275property"]("ngForOf",a.missions),s["\u0275\u0275advance"](4),s["\u0275\u0275property"]("owlDateTimeTrigger",r)("owlDateTime",r),s["\u0275\u0275advance"](1),s["\u0275\u0275property"]("pickerType","calendar"),s["\u0275\u0275advance"](4),s["\u0275\u0275property"]("owlDateTimeTrigger",o)("owlDateTime",o),s["\u0275\u0275advance"](1),s["\u0275\u0275property"]("pickerType","timer")("startAt",(null==a.timesheet?null:a.timesheet.startTime)||a.initTime),s["\u0275\u0275advance"](4),s["\u0275\u0275property"]("disabled",a.timesheetForm.invalid||a.timesheetForm.pristine),s["\u0275\u0275advance"](1),s["\u0275\u0275textInterpolate1"](" ",a.isCreateForm?"Legg til":"Oppdater"," ")}}var F=function(){function e(e){var t=this;this._formBuilder=e,this.formSubmitted=new s.EventEmitter,this.missionsSearch=new s.EventEmitter,this.isCreateForm=!1,this.initTime=new Date,this.onSubmit=function(){t.timesheetForm.valid&&t.timesheetForm.dirty&&t.formSubmitted.emit(t.convertFormToTimesheet(t.timesheetForm.getRawValue()))},this.initTime.setHours(6,0,0,0)}return e.prototype.ngOnInit=function(){var e=this;this.timesheet&&null!=this.timesheet?this.timesheet.mission=this.missions.find((function(t){return t.id==e.timesheet.missionId})):this.isCreateForm=!0,this.initalizeForm(this.timesheet),this.initMissionListener()},e.prototype.displayMissionAddress=function(e){return null==e?null:e.address},e.prototype.initalizeForm=function(e){this.timesheetForm=this._formBuilder.group({id:e?e.id:null,mission:[{value:this.missionPreset||(e?e.mission:null),disabled:this.missionPreset},[d.s.required]],date:[{value:this.datePreset||(this.isCreateForm?null:new Date(e.startTime)),disabled:this.datePreset},[d.s.required]],timeRange:[this.isCreateForm?[]:[new Date(e.startTime),new Date(e.endTime)],[d.s.required,this.timeRangeValidator()]],comment:[e?e.comment:null,[d.s.required,d.s.maxLength(400)]]},{validators:this.isMissionValidator()})},e.prototype.initMissionListener=function(){var e=this;this.mission.valueChanges.pipe(Object(p.a)((function(e){return"string"==typeof e})),Object(f.a)(400)).subscribe((function(t){return e.missionsSearch.emit(t)}))},e.prototype.timeRangeValidator=function(){return function(e){return e.value[0]&&e.value[1]?null:{timeRangeInvalid:{value:e.value}}}},e.prototype.isMissionValidator=function(){return function(e){return e.value.mission instanceof Object?null:{missionInvalid:{value:e.value}}}},e.prototype.convertFormToTimesheet=function(e){var t=e.date.toDateString();return{id:e.id,missionId:e.mission.id,comment:e.comment,startTime:new Date(t+" "+e.timeRange[0].toTimeString()),endTime:new Date(t+" "+e.timeRange[1].toTimeString())}},Object.defineProperty(e.prototype,"mission",{get:function(){return this.timesheetForm.get("mission")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"date",{get:function(){return this.timesheetForm.get("date")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"timeRange",{get:function(){return this.timesheetForm.get("timeRange")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"comment",{get:function(){return this.timesheetForm.get("comment")},enumerable:!0,configurable:!0}),e.\u0275fac=function(t){return new(t||e)(s["\u0275\u0275directiveInject"](d.c))},e.\u0275cmp=s["\u0275\u0275defineComponent"]({type:e,selectors:[["app-timesheet-form-view"]],inputs:{missions:"missions",timesheet:"timesheet",datePreset:"datePreset",missionPreset:"missionPreset"},outputs:{formSubmitted:"formSubmitted",missionsSearch:"missionsSearch"},decls:1,vars:1,consts:[["fxLayout","column","fxLayoutAlign","start stretch",3,"formGroup",4,"ngIf"],["fxLayout","column","fxLayoutAlign","start stretch",3,"formGroup"],["matInput","","placeholder","Oppdrag","formControlName","mission","aria-label","Velg oppdrag",3,"matAutocomplete"],[3,"displayWith"],["auto1","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["fxLayout","row","fxLayoutAlign","space-between start"],["fxFlex","46"],[1,"w-100"],["matInput","","placeholder","Dato","formControlName","date","aria-label","Velg dato","required","",3,"owlDateTimeTrigger","owlDateTime"],[3,"pickerType"],["d3",""],["matInput","","placeholder","Arbeidstid","formControlName","timeRange","required","","selectMode","range",3,"owlDateTimeTrigger","owlDateTime"],["stepMinute","15",3,"pickerType","startAt"],["t1",""],["matInput","","placeholder","Kommentar","formControlName","comment","aria-label","Kommentar","required","","maxlength","400"],["appHttpCommandButton","","mat-raised-button","","color","primary",1,"w-100",3,"disabled","click"],[3,"value"]],template:function(e,t){1&e&&s["\u0275\u0275template"](0,D,21,13,"form",0),2&e&&s["\u0275\u0275property"]("ngIf",t.timesheetForm)},directives:[h.l,d.t,d.m,g.c,g.b,d.e,v.c,b.a,d.b,y.c,d.l,d.d,y.a,h.k,g.a,S.d,d.r,S.g,S.c,d.h,T.b,w.a,P.i],styles:[""],changeDetection:0}),e}(),j=function(){function e(e,t,i,n){var r=this;this._dateTimeService=e,this._userTimesheetService=t,this._missionService=i,this._notificationService=n,this.Roles=m.g,this.finished=new s.EventEmitter,this.missionsSearchSubject=new l.a(void 0),this.onMissionSearch=function(e){return r.missionsSearchSubject.next(e)}}return e.prototype.ngOnInit=function(){var e=this;this.missions$=this.missionsSearchSubject.asObservable().pipe(Object(c.a)((function(t){return e._missionService.getBy$((function(i){return e.filterMission(i,t)}))}))),this.config.idPreset?this.timesheetPreset$=this._userTimesheetService.get$(this.config.idPreset).pipe(Object(u.a)((function(t){t||e.finished.emit()}))):this.isCreateForm=!0},e.prototype.onSubmit=function(e){e&&null!=e||this.finished.emit(null),this.isCreateForm?this.createTimesheet(e):this.editTimesheet(e)},e.prototype.createTimesheet=function(e){var t=this;this._userTimesheetService.add$(e).subscribe((function(e){t._notificationService.setNotification("Time registrert!"),t.finished.emit(e)}))},e.prototype.editTimesheet=function(e){var t=this;this._userTimesheetService.update$(e).subscribe((function(e){t._notificationService.setNotification("Time oppdatert!"),t.finished.emit(e)}))},e.prototype.filterMission=function(e,t){if(!t)return this.filterInitialMission(e);var i=!t||null==t||e.address.toLowerCase().includes(t.toLowerCase()),n=+t;return isNaN(n)||(i=i||e.id===n),i},e.prototype.filterInitialMission=function(e){var t=this._dateTimeService.getNDaysAgo(30);return new Date(e.updatedAt).getTime()>=t||new Date(e.lastVisited).getTime()>=t},e.\u0275fac=function(t){return new(t||e)(s["\u0275\u0275directiveInject"](o.g),s["\u0275\u0275directiveInject"](o.B),s["\u0275\u0275directiveInject"](o.s),s["\u0275\u0275directiveInject"](o.v))},e.\u0275cmp=s["\u0275\u0275defineComponent"]({type:e,selectors:[["app-timesheet-form"]],inputs:{config:"config"},outputs:{finished:"finished"},decls:3,vars:8,consts:[[3,"missionPreset","datePreset","timesheet","missions","formSubmitted","missionsSearch"]],template:function(e,t){1&e&&(s["\u0275\u0275elementStart"](0,"app-timesheet-form-view",0),s["\u0275\u0275listener"]("formSubmitted",(function(e){return t.onSubmit(e)}))("missionsSearch",(function(e){return t.onMissionSearch(e)})),s["\u0275\u0275pipe"](1,"async"),s["\u0275\u0275pipe"](2,"async"),s["\u0275\u0275elementEnd"]()),2&e&&s["\u0275\u0275property"]("missionPreset",t.config.missionPreset)("datePreset",t.config.datePreset)("timesheet",s["\u0275\u0275pipeBind1"](1,4,t.timesheetPreset$))("missions",s["\u0275\u0275pipeBind1"](2,6,t.missions$))},directives:[F],pipes:[h.b],encapsulation:2,changeDetection:0}),e}(),C=function(){function e(e,t,i){var n=this;this._userTimesheetService=e,this._bottomSheetRef=t,this.config=i,this.close=function(){return n._bottomSheetRef.dismiss()},this.deleteTimesheet=function(){return n._userTimesheetService.delete$(n.config.idPreset).subscribe((function(e){return n.close()}))}}return e.prototype.ngOnInit=function(){var e=!this.config||!this.config.idPreset;this.navConfig={title:e?"Registrer time":"Rediger time",leftBtn:{icon:"close",callback:this.close},buttons:e?void 0:[{icon:"delete_forever",callback:this.deleteTimesheet}]}},e.\u0275fac=function(t){return new(t||e)(s["\u0275\u0275directiveInject"](o.B),s["\u0275\u0275directiveInject"](r.d),s["\u0275\u0275directiveInject"](r.a))},e.\u0275cmp=s["\u0275\u0275defineComponent"]({type:e,selectors:[["app-timesheet-form-sheet-wrapper"]],decls:2,vars:2,consts:[[3,"config"],[3,"config","finished"]],template:function(e,t){1&e&&(s["\u0275\u0275elementStart"](0,"app-simple-top-nav",0),s["\u0275\u0275elementStart"](1,"app-timesheet-form",1),s["\u0275\u0275listener"]("finished",(function(){return t.close()})),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"]()),2&e&&(s["\u0275\u0275property"]("config",t.navConfig),s["\u0275\u0275advance"](1),s["\u0275\u0275property"]("config",t.config))},directives:[a.a,j],encapsulation:2,changeDetection:0}),e}(),x=[{path:"",component:function(){function e(e,t,i){var n=this;this.bottomSheet=e,this.route=t,this.location=i,this.openDialog=function(e){n.bottomSheet.open(C,{data:e}).afterDismissed().subscribe((function(e){return n.location.back()}))};var r={idPreset:+this.route.snapshot.queryParams.idPreset,missionPreset:this.route.snapshot.queryParams.missionPreset?JSON.parse(this.route.snapshot.queryParams.missionPreset):void 0,datePreset:this.route.snapshot.queryParams.datePreset?new Date(this.route.snapshot.queryParams.datePreset):void 0};this.openDialog(r)}return e.\u0275fac=function(t){return new(t||e)(s["\u0275\u0275directiveInject"](r.b),s["\u0275\u0275directiveInject"](n.a),s["\u0275\u0275directiveInject"](h.h))},e.\u0275cmp=s["\u0275\u0275defineComponent"]({type:e,selectors:[["ng-component"]],decls:0,vars:0,template:function(e,t){},encapsulation:2,changeDetection:0}),e}()}],E=function(){function e(){}return e.\u0275mod=s["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=s["\u0275\u0275defineInjector"]({factory:function(t){return new(t||e)},imports:[[n.g.forChild(x)],n.g]}),e}(),O=i("Ocsb"),M=function(){function e(){}return e.\u0275mod=s["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=s["\u0275\u0275defineInjector"]({factory:function(t){return new(t||e)},imports:[[O.a,E]]}),e}()}}]);