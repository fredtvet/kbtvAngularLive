(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{skTp:function(e,t,n){"use strict";n.r(t),n.d(t,"MissionImageListModule",(function(){return se}));var i=n("mrSG"),a=n("9AJY"),r=n("XLlq"),o=n("PCNd"),c=n("K+RL"),l=n("9RCi"),s=n("lJxs"),d=n("G+73"),m=n("Gil/"),p="CREATE_MISSION_IMAGES",u=n("fXoL"),f=function(){function e(){}return e.prototype.handle$=function(e){var t=this;return e.pipe(Object(m.a)([p]),Object(s.a)((function(e){return{actionId:d.a,propagate:!0,request:t.createHttpRequest(e.action),stateSnapshot:e.stateSnapshot}})))},e.prototype.createHttpRequest=function(e){return{apiUrl:"/MissionImages?missionId="+e.missionId,body:this.createHttpBody(e),method:"POST",cancelMessage:"Oppretting av "+e.fileWrappers.length+" bilder p\xe5 oppdrag "+e.missionId+" er reversert."}},e.prototype.createHttpBody=function(e){for(var t=new FormData,n=0;n<e.fileWrappers.length;n++){var i=e.fileWrappers[n].modifiedFile;t.append("file",i,i.name)}return t},e.\u0275prov=u["\u0275\u0275defineInjectable"]({token:e,factory:e.\u0275fac=function(t){return new(t||e)}}),e}(),g=n("oEjJ"),v={actionId:p,stateProperties:["missionImages"],reducerFn:function(e,t){t.fileWrappers&&t.missionId||console.error("no files or missionId provided");for(var n=[],i=0;i<t.fileWrappers.length;i++){var a=t.fileWrappers[i];n.push({id:a.id,missionId:t.missionId,fileName:a.modifiedFile.name,temp_localFileUrl:URL.createObjectURL(a.modifiedFile)})}return e.missionImages=Object(g.a)(e.missionImages,n,"id"),e}},I=n("tyNb"),h=n("itXk"),b=n("vkgz"),y=n("xzsT"),w=n("1YJq"),S=n("u3SY"),C=n("6NQd"),x=n("rEs6"),j=n("0IaG"),k=n("M6VK"),O=n("KaUG"),_=n("NlAt"),R=n("FnCK"),E=n("c6Pr"),M=n("swmS"),F=n("/XYe"),L=n("rR48"),P=n("SWpy"),B=n("/eqr"),H=function(){return function(e){this.actionId=p,this.fileWrappers=[],this.missionId=e.missionId;for(var t=0;t<e.files.length;t++)this.fileWrappers.push(new P.a(e.files[t],Object(B.a)()))}}(),N=n("lMzk"),T=n("sYIv"),V=function(){function e(e,t){var n=this;this.notificationService=e,this.store=t,this.getByMissionId$=function(e){return n.store.select$(["missions","employers","missionImages"]).pipe(Object(s.a)((function(t){var i=new _.a("missions",["missionImages"],["employers"]),a=Object(R.a)(t,i,e);return n.mission=a,null==a?void 0:a.missionImages})))},this.add=function(e){for(var t=0;t<e.files.length;t++)if(!Object(F.a)(e.files[t],L.a))return n.notificationService.notify({title:"Filtype ikke tillatt for en eller flere filer",type:2});n.store.dispatch(new H(e))},this.delete=function(e){return n.store.dispatch(Object(i.a)(Object(i.a)({},e),{stateProp:"missionImages",actionId:E.a}))},this.mailImages=function(e,t){return n.store.dispatch({toEmail:e,ids:t,stateProp:"missionImages",actionId:M.a})}}return e.\u0275fac=function(t){return new(t||e)(u["\u0275\u0275inject"](N.NotificationService),u["\u0275\u0275inject"](T.a))},e.\u0275prov=u["\u0275\u0275defineInjectable"]({token:e,factory:e.\u0275fac,providedIn:"any"}),e}(),D=n("cVEA"),U=n("/t3+"),$=n("XiUz"),q=n("znSr"),z=n("bTqV"),W=n("NFeN"),X=n("ofXK"),A=n("lb8S");function G(e,t){if(1&e){var n=u["\u0275\u0275getCurrentView"]();u["\u0275\u0275elementStart"](0,"img",6),u["\u0275\u0275listener"]("tap",(function(){u["\u0275\u0275restoreView"](n);var e=u["\u0275\u0275nextContext"]();return e.toolbarHidden=!e.toolbarHidden}))("swiperight",(function(){return u["\u0275\u0275restoreView"](n),u["\u0275\u0275nextContext"]().previousImage()}))("swipeleft",(function(){return u["\u0275\u0275restoreView"](n),u["\u0275\u0275nextContext"]().nextImage()})),u["\u0275\u0275pipe"](1,"appFileUrl"),u["\u0275\u0275elementEnd"]()}if(2&e){var i=u["\u0275\u0275nextContext"]();u["\u0275\u0275property"]("src",u["\u0275\u0275pipeBind2"](1,1,i.currentImage,"images"),u["\u0275\u0275sanitizeUrl"])}}var J=function(){function e(e){var t=this;this.menuService=e,this.toolbarHidden=!1,this.currentImageChanged=new u.EventEmitter,this.closed=new u.EventEmitter,this.close=function(){return t.closed.emit()},this.openBottomSheet=function(){return t.menuService.open(t.actions)}}return e.prototype.ngOnInit=function(){var e=this;this.currentImage&&(this.index=this.images.findIndex((function(t){return t.id==e.currentImage.id})))},e.prototype.changeCurrentImage=function(e){this.currentImage=e,this.currentImageChanged.emit(e)},e.prototype.nextImage=function(){if(this.index>=this.images.length-1)return null;this.index++,this.changeCurrentImage(this.images[this.index])},e.prototype.previousImage=function(){if(this.index<=0)return null;this.index--,this.changeCurrentImage(this.images[this.index])},e.\u0275fac=function(t){return new(t||e)(u["\u0275\u0275directiveInject"](D.a))},e.\u0275cmp=u["\u0275\u0275defineComponent"]({type:e,selectors:[["app-image-viewer"]],inputs:{images:"images",currentImage:"currentImage",actions:"actions"},outputs:{currentImageChanged:"currentImageChanged",closed:"closed"},decls:11,vars:5,consts:[["fxLayout","row","fxLayoutAlign","space-between center",1,"overlay_container","image_toolbar",3,"fxHide"],["mat-icon-button","","aria-label","Lukk",3,"click"],[1,"scale-150"],["mat-icon-button","",3,"click"],["alt","oppdragsbilde","layout-fill","",3,"src","tap","swiperight","swipeleft",4,"ngIf"],[1,"overlay_container","page_counter",3,"fxHide"],["alt","oppdragsbilde","layout-fill","",3,"src","tap","swiperight","swipeleft"]],template:function(e,t){1&e&&(u["\u0275\u0275elementStart"](0,"mat-toolbar",0),u["\u0275\u0275elementStart"](1,"button",1),u["\u0275\u0275listener"]("click",(function(){return t.close()})),u["\u0275\u0275elementStart"](2,"mat-icon",2),u["\u0275\u0275text"](3,"chevron_left"),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementStart"](4,"button",3),u["\u0275\u0275listener"]("click",(function(){return t.openBottomSheet()})),u["\u0275\u0275elementStart"](5,"mat-icon"),u["\u0275\u0275text"](6,"more_vert"),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275template"](7,G,2,4,"img",4),u["\u0275\u0275elementStart"](8,"mat-toolbar",5),u["\u0275\u0275elementStart"](9,"h5"),u["\u0275\u0275text"](10),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"]()),2&e&&(u["\u0275\u0275property"]("fxHide",t.toolbarHidden),u["\u0275\u0275advance"](7),u["\u0275\u0275property"]("ngIf",t.currentImage),u["\u0275\u0275advance"](1),u["\u0275\u0275property"]("fxHide",t.toolbarHidden),u["\u0275\u0275advance"](2),u["\u0275\u0275textInterpolate2"]("",t.index+1," / ",t.images.length,""))},directives:[U.a,$.c,$.b,q.b,z.b,W.a,X.m],pipes:[A.a],styles:["img[_ngcontent-%COMP%]{display:block;max-width:100%;max-height:100%;transform:translatex(calc(50vw - 50%)) translatey(calc(50vh - 50%))}.top_left_fab[_ngcontent-%COMP%]{position:absolute;left:8px}.top_right_fab[_ngcontent-%COMP%]{position:absolute;right:8px}.overlay_container[_ngcontent-%COMP%]{background:rgba(0,0,0,.5);color:#fff;position:absolute;z-index:2}.image_toolbar[_ngcontent-%COMP%]{left:0}.page_counter[_ngcontent-%COMP%]{width:100%;justify-content:center;bottom:0}"],changeDetection:0}),e}(),Y=function(){function e(e,t,n,i,a){var r=this;this.confirmService=e,this.downloaderService=t,this.facade=n,this.dialogRef=i,this.data=a,this.close=function(){return r.dialogRef.close()},this.downloadImage=function(){return r.downloaderService.downloadUrl(Object(S.a)(r.data.currentImage.fileName,"images"))},this.openConfirmDeleteDialog=function(){r.confirmService.open({title:"Slett bilde?",confirmText:"Slett",confirmCallback:function(){return r.deleteCurrentImage()}})}}return Object.defineProperty(e.prototype,"actions",{get:function(){return[{text:"Last ned bilde",icon:"cloud_download",callback:this.downloadImage},{text:"Slett bilde",icon:"delete",callback:this.openConfirmDeleteDialog,allowedRoles:[w.Roles.Leder]}]},enumerable:!1,configurable:!0}),e.prototype.deleteCurrentImage=function(){this.dialogRef.close(),this.facade.delete({id:this.data.currentImage.id})},e.\u0275fac=function(t){return new(t||e)(u["\u0275\u0275directiveInject"](k.a),u["\u0275\u0275directiveInject"](O.a),u["\u0275\u0275directiveInject"](V),u["\u0275\u0275directiveInject"](j.e),u["\u0275\u0275directiveInject"](j.a))},e.\u0275cmp=u["\u0275\u0275defineComponent"]({type:e,selectors:[["app-timesheet-card-dialog-wrapper"]],decls:1,vars:3,consts:[[3,"images","currentImage","actions","currentImageChanged","closed"]],template:function(e,t){1&e&&(u["\u0275\u0275elementStart"](0,"app-image-viewer",0),u["\u0275\u0275listener"]("currentImageChanged",(function(e){return t.data.currentImage=e}))("closed",(function(){return t.close()})),u["\u0275\u0275elementEnd"]()),2&e&&u["\u0275\u0275property"]("images",t.data.images)("currentImage",t.data.currentImage)("actions",t.actions)},directives:[J],encapsulation:2,changeDetection:0}),e}(),K=n("/bry"),Q=n("sNHF"),Z=n("tYFc"),ee=n("ci80"),te=n("ILfg"),ne=n("z9HP"),ie=["imageInput"];function ae(e,t){if(1&e){var n=u["\u0275\u0275getCurrentView"]();u["\u0275\u0275elementStart"](0,"app-selectable-list",7,8),u["\u0275\u0275listener"]("selectionChanged",(function(e){return u["\u0275\u0275restoreView"](n),u["\u0275\u0275nextContext"](2).onSelectionChange(e)}))("itemClicked",(function(e){u["\u0275\u0275restoreView"](n);var t=u["\u0275\u0275nextContext"]().$implicit;return u["\u0275\u0275nextContext"]().openImageViewer(e,t.images)})),u["\u0275\u0275elementEnd"]()}if(2&e){var i=u["\u0275\u0275nextContext"]().$implicit;u["\u0275\u0275nextContext"]();var a=u["\u0275\u0275reference"](3);u["\u0275\u0275property"]("totalRows",i.isXs?2:4)("entities",i.images)("itemTemplate",a)}}function re(e,t){if(1&e&&(u["\u0275\u0275elementStart"](0,"app-main-skeleton",4),u["\u0275\u0275element"](1,"app-main-top-nav-bar",5),u["\u0275\u0275template"](2,ae,2,3,"app-selectable-list",6),u["\u0275\u0275elementEnd"]()),2&e){var n=t.$implicit;u["\u0275\u0275property"]("fabs",n.fabs),u["\u0275\u0275advance"](1),u["\u0275\u0275property"]("config",n.navConfig),u["\u0275\u0275advance"](1),u["\u0275\u0275property"]("ngIf",n.images)}}function oe(e,t){1&e&&(u["\u0275\u0275element"](0,"img",9),u["\u0275\u0275pipe"](1,"appFileUrl")),2&e&&u["\u0275\u0275property"]("src",u["\u0275\u0275pipeBind2"](1,1,t.$implicit,"thumbnails"),u["\u0275\u0275sanitizeUrl"])}var ce=[{path:"",component:function(e){function t(t,n,a,r,o,c,l,d,m,p){var u=e.call(this)||this;return u.downloaderService=t,u.deviceInfoService=n,u.menuService=a,u.formService=r,u.confirmService=o,u.dialog=c,u.facade=l,u.route=d,u.notificationService=m,u.router=p,u.vm$=Object(h.a)([u.facade.getByMissionId$(u.missionId),u.deviceInfoService.isXs$,u.currentFabs$]).pipe(Object(b.a)((function(e){return u.images=e[0]})),Object(s.a)((function(e){var t=Object(i.c)(e,3);return{images:t[0],isXs:t[1],fabs:t[2],navConfig:u.navConfig}}))),u.uploadImages=function(e){return u.facade.add({missionId:u.missionId,files:e})},u.openImageInput=function(){if(!window.navigator.onLine)return u.notificationService.notify(y.a.OnlineRequired);u.imageInput.nativeElement.click()},u.deleteSelectedImages=function(){u.facade.delete({ids:u.currentSelections}),u.selectableList.clearSelections()},u.openConfirmDeleteDialog=function(){u.confirmService.open({title:"Slett utvalgte bilder?",confirmText:"Slett",confirmCallback:u.deleteSelectedImages})},u.openMailImageSheet=function(){var e,t;u.formService.open({formConfig:Object(i.a)(Object(i.a)({},x.a),{initialValue:{email:null===(t=null===(e=u.facade.mission)||void 0===e?void 0:e.employer)||void 0===t?void 0:t.email}}),navConfig:{title:"Send bilder"},submitCallback:function(e){u.facade.mailImages(e.email,u.currentSelections),u.selectableList.clearSelections()}})},u.openBottomSheetMenu=function(){u.menuService.open([{icon:"send",text:"Send alle bilder",callback:u.openMailImageSheet,allowedRoles:w.RolePresets.Authority},{icon:"cloud_download",text:"Last ned alle",callback:u.downloadImages,params:[u.images]}])},u.downloadImages=function(e){return u.downloaderService.downloadUrls(e.map((function(e){return Object(S.a)(e.fileName,"images")})))},u.onBack=function(){return u.router.navigate(["../"],{relativeTo:u.route.parent})},u.navConfig={title:"Bilder",backFn:u.onBack,buttons:[{icon:"more_vert",callback:u.openBottomSheetMenu}]},u.staticFabs=[{icon:"camera_enhance",aria:"Ta bilde",color:"accent",callback:u.openImageInput,allowedRoles:w.RolePresets.Internal}],u.selectedItemsFabs=[{icon:"send",aria:"Send",color:"accent",callback:u.openMailImageSheet,allowedRoles:[w.Roles.Leder]},{icon:"delete_forever",aria:"Slett",color:"warn",callback:u.openConfirmDeleteDialog,allowedRoles:[w.Roles.Leder]}],u}return Object(i.b)(t,e),Object.defineProperty(t.prototype,"missionId",{get:function(){return this.route.parent.parent.snapshot.params.id},enumerable:!1,configurable:!0}),t.prototype.openImageViewer=function(e,t){this.dialog.open(Y,{width:"100%",height:"100%",panelClass:"image_viewer_dialog",data:{currentImage:e,images:t}})},t.\u0275fac=function(e){return new(e||t)(u["\u0275\u0275directiveInject"](O.a),u["\u0275\u0275directiveInject"](K.a),u["\u0275\u0275directiveInject"](D.a),u["\u0275\u0275directiveInject"](Q.FormService),u["\u0275\u0275directiveInject"](k.a),u["\u0275\u0275directiveInject"](j.b),u["\u0275\u0275directiveInject"](V),u["\u0275\u0275directiveInject"](I.a),u["\u0275\u0275directiveInject"](N.NotificationService),u["\u0275\u0275directiveInject"](I.b))},t.\u0275cmp=u["\u0275\u0275defineComponent"]({type:t,selectors:[["app-mission-image-list"]],viewQuery:function(e,t){var n;1&e&&u["\u0275\u0275viewQuery"](ie,!0),2&e&&u["\u0275\u0275queryRefresh"](n=u["\u0275\u0275loadQuery"]())&&(t.imageInput=n.first)},features:[u["\u0275\u0275InheritDefinitionFeature"]],decls:6,vars:3,consts:[["overlayMode","true",3,"fabs",4,"ngIf"],["imgTemplate",""],["type","file","multiple","",2,"display","none",3,"change"],["imageInput",""],["overlayMode","true",3,"fabs"],["navbar","",3,"config"],["identifier","id","selectedText","Bilde valgt",3,"totalRows","entities","itemTemplate","selectionChanged","itemClicked",4,"ngIf"],["identifier","id","selectedText","Bilde valgt",3,"totalRows","entities","itemTemplate","selectionChanged","itemClicked"],["selectableList",""],["appImageErrorReloader","","alt","oppdragsbilde",1,"entity-card",3,"src"]],template:function(e,t){1&e&&(u["\u0275\u0275template"](0,re,3,3,"app-main-skeleton",0),u["\u0275\u0275pipe"](1,"async"),u["\u0275\u0275template"](2,oe,2,4,"ng-template",null,1,u["\u0275\u0275templateRefExtractor"]),u["\u0275\u0275elementStart"](4,"input",2,3),u["\u0275\u0275listener"]("change",(function(e){return t.uploadImages(e.target.files)})),u["\u0275\u0275elementEnd"]()),2&e&&u["\u0275\u0275property"]("ngIf",u["\u0275\u0275pipeBind1"](1,1,t.vm$))},directives:[X.m,Z.a,ee.a,te.a,ne.a],pipes:[X.b,A.a],encapsulation:2,changeDetection:0}),t}(C.a)}],le=function(){function e(){}return e.\u0275mod=u["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=u["\u0275\u0275defineInjector"]({factory:function(t){return new(t||e)},imports:[[I.f.forChild(ce)],I.f]}),e}(),se=function(){function e(){}return e.\u0275mod=u["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=u["\u0275\u0275defineInjector"]({factory:function(t){return new(t||e)},providers:Object(i.d)([{provide:c.c,useValue:v,multi:!0},{provide:c.b,useClass:f,multi:!0}],a.b),imports:[[o.a,l.a,r.a,le]]}),e}()}}]);
//# sourceMappingURL=22.597630544155f9774056.js.map