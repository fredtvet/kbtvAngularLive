(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{skTp:function(e,t,n){"use strict";n.r(t),n.d(t,"MissionImageListModule",(function(){return Q}));var i=n("DUip"),a=n("mrSG"),r=n("VnD/"),o=n("xMyE"),c=n("ny24"),s=n("1YJq"),l=n("1eh6"),d=n("1ua0"),m=n("h/AT"),u=n("TYT/"),p=n("dJ3e"),f=n("9qP0"),g=n("H5r2"),h=function(){function e(e,t,n,i){var a=this;this._missionImageService=e,this._notificationService=t,this._bottomSheetRef=n,this.data=i,this.close=function(e){return a._bottomSheetRef.dismiss(e)},this.mailImages=function(e){return a._missionImageService.mailImages$(e,a.data.ids).subscribe((function(e){a.close(!0),a._notificationService.setNotification("Vellykket! "+a.data.ids.length+" "+(a.data.ids.length>1?"bilder":"bilde")+" sendt")}))}}return e.prototype.ngOnInit=function(){this.navConfig={title:"Send bilder",leftBtn:{icon:"close",callback:this.close}}},e.\u0275fac=function(t){return new(t||e)(u["\u0275\u0275directiveInject"](p.r),u["\u0275\u0275directiveInject"](p.w),u["\u0275\u0275directiveInject"](m.d),u["\u0275\u0275directiveInject"](m.a))},e.\u0275cmp=u["\u0275\u0275defineComponent"]({type:e,selectors:[["app-mail-image-sheet"]],decls:2,vars:2,consts:[[3,"config"],[3,"toEmailPreset","formSubmitted"]],template:function(e,t){1&e&&(u["\u0275\u0275elementStart"](0,"app-simple-top-nav",0),u["\u0275\u0275elementStart"](1,"app-mail-to-form",1),u["\u0275\u0275listener"]("formSubmitted",(function(e){return t.mailImages(e)})),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"]()),2&e&&(u["\u0275\u0275property"]("config",t.navConfig),u["\u0275\u0275advance"](1),u["\u0275\u0275property"]("toEmailPreset",t.data.toEmailPreset))},directives:[f.a,g.a],encapsulation:2,changeDetection:0}),e}(),b=n("ea4N"),v=n("2WDa"),I=n("cocx"),w=n("FfOm"),y=n("uLXW"),S=n("p+mS"),C=n("GsDI"),x=n("Valr");function k(e,t){if(1&e){var n=u["\u0275\u0275getCurrentView"]();u["\u0275\u0275elementStart"](0,"img",7),u["\u0275\u0275listener"]("tap",(function(){u["\u0275\u0275restoreView"](n);var e=u["\u0275\u0275nextContext"]();return e.toolbarHidden=!e.toolbarHidden}))("swiperight",(function(){return u["\u0275\u0275restoreView"](n),u["\u0275\u0275nextContext"]().previousImage()}))("swipeleft",(function(){return u["\u0275\u0275restoreView"](n),u["\u0275\u0275nextContext"]().nextImage()})),u["\u0275\u0275elementEnd"]()}if(2&e){var i=u["\u0275\u0275nextContext"]();u["\u0275\u0275property"]("src",i.currentImage.fileURL,u["\u0275\u0275sanitizeUrl"])}}var j=function(){function e(e){var t=this;this.bottomSheet=e,this.toolbarHidden=!1,this.imageDeleted=new u.EventEmitter,this.currentImageChanged=new u.EventEmitter,this.close=new u.EventEmitter,this.finished=function(){return t.close.emit()},this.openBottomSheet=function(){return t.bottomSheet.open(I.a,{data:t.actions})}}return e.prototype.ngOnInit=function(){var e=this;this.currentImage&&(this.index=this.images.findIndex((function(t){return t.id==e.currentImage.id})))},e.prototype.changeCurrentImage=function(e){this.currentImage=e,this.currentImageChanged.emit(e)},e.prototype.nextImage=function(){if(this.index>=this.images.length-1)return null;this.index++,this.changeCurrentImage(this.images[this.index])},e.prototype.previousImage=function(){if(this.index<=0)return null;this.index--,this.changeCurrentImage(this.images[this.index])},e.\u0275fac=function(t){return new(t||e)(u["\u0275\u0275directiveInject"](m.b))},e.\u0275cmp=u["\u0275\u0275defineComponent"]({type:e,selectors:[["app-image-viewer"]],inputs:{images:"images",currentImage:"currentImage",actions:"actions"},outputs:{imageDeleted:"imageDeleted",currentImageChanged:"currentImageChanged",close:"close"},decls:12,vars:5,consts:[["fxLayout","row","fxLayoutAlign","space-between center",1,"toolbar-slim","image-toolbar","color-accent"],["imageToolBar",""],["mat-icon-button","","aria-label","Lukk",3,"click"],[1,"scale-150"],["mat-icon-button","",3,"click"],["alt","oppdragsbilde","layout-fill","",3,"src","tap","swiperight","swipeleft",4,"ngIf"],[1,"page_counter"],["alt","oppdragsbilde","layout-fill","",3,"src","tap","swiperight","swipeleft"]],template:function(e,t){1&e&&(u["\u0275\u0275elementStart"](0,"mat-toolbar",0,1),u["\u0275\u0275elementStart"](2,"button",2),u["\u0275\u0275listener"]("click",(function(){return t.finished()})),u["\u0275\u0275elementStart"](3,"mat-icon",3),u["\u0275\u0275text"](4,"chevron_left"),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementStart"](5,"button",4),u["\u0275\u0275listener"]("click",(function(){return t.openBottomSheet()})),u["\u0275\u0275elementStart"](6,"mat-icon"),u["\u0275\u0275text"](7,"more_vert"),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275template"](8,k,1,1,"img",5),u["\u0275\u0275elementStart"](9,"div",6),u["\u0275\u0275elementStart"](10,"h5"),u["\u0275\u0275text"](11),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"]()),2&e&&(u["\u0275\u0275property"]("@showHideToolbar",t.toolbarHidden?"hide":"show"),u["\u0275\u0275advance"](8),u["\u0275\u0275property"]("ngIf",t.currentImage),u["\u0275\u0275advance"](1),u["\u0275\u0275property"]("@showHideCounter",t.toolbarHidden?"hide":"show"),u["\u0275\u0275advance"](2),u["\u0275\u0275textInterpolate2"]("",t.index+1," / ",t.images.length,""))},directives:[w.a,y.c,y.b,S.b,C.a,x.l],styles:["img[_ngcontent-%COMP%]{display:block;max-width:100%;max-height:100%;transform:translatex(calc(50vw - 50%)) translatey(calc(50vh - 50%))}.top_left_fab[_ngcontent-%COMP%]{position:absolute;left:8px}.top_right_fab[_ngcontent-%COMP%]{position:absolute;right:8px}.image-toolbar[_ngcontent-%COMP%]{position:absolute;left:0;z-index:2;overflow:hidden;background:transparent!important}.page_counter[_ngcontent-%COMP%]{width:100%;position:absolute;bottom:0;text-align:center;color:#fff;opacity:.5}"],data:{animation:[Object(v.p)("showHideToolbar",[Object(v.m)("show",Object(v.n)({top:"0px"})),Object(v.m)("hide",Object(v.n)({top:"-56px"})),Object(v.o)("show => hide",[Object(v.e)(".1s ease-out")]),Object(v.o)("hide => show",[Object(v.e)(".1s ease-in")])]),Object(v.p)("showHideCounter",[Object(v.m)("show",Object(v.n)({bottom:"0px"})),Object(v.m)("hide",Object(v.n)({bottom:"-56px"})),Object(v.o)("show => hide",[Object(v.e)(".1s ease-out")]),Object(v.o)("hide => show",[Object(v.e)(".1s ease-in")])])]},changeDetection:0}),e}(),E=function(){function e(e,t,n,i,a){var o=this;this.dialog=e,this.downloaderService=t,this.missionImageService=n,this.dialogRef=i,this.data=a,this.deleteImage=function(e){return o.missionImageService.delete$(e).subscribe((function(e){return o.dialogRef.close()}))},this.close=function(){return o.dialogRef.close()},this.deleteCurrentImage=function(){return o.missionImageService.delete$(o.data.currentImage.id).subscribe((function(e){return o.dialogRef.close()}))},this.downloadImage=function(){return o.downloaderService.downloadUrl(o.data.currentImage.fileURL)},this.downloadImages=function(){return o.downloaderService.downloadUrls(o.data.images.map((function(e){return e.fileURL})))},this.openConfirmDeleteDialog=function(){o.dialog.open(d.a,{data:"Bekreft at du \xf8nsker \xe5 slette bildet."}).afterClosed().pipe(Object(r.a)((function(e){return e}))).subscribe((function(e){return o.deleteCurrentImage()}))}}return e.prototype.ngOnInit=function(){this.actions=[{text:"Last ned bilde",icon:"cloud_download",callback:this.downloadImage},{text:"Last ned alle",icon:"cloud_download",callback:this.downloadImages},{text:"Slett bilde",icon:"delete",callback:this.openConfirmDeleteDialog,allowedRoles:[s.i.Leder]}]},e.\u0275fac=function(t){return new(t||e)(u["\u0275\u0275directiveInject"](b.b),u["\u0275\u0275directiveInject"](p.k),u["\u0275\u0275directiveInject"](p.r),u["\u0275\u0275directiveInject"](b.e),u["\u0275\u0275directiveInject"](b.a))},e.\u0275cmp=u["\u0275\u0275defineComponent"]({type:e,selectors:[["app-timesheet-card-dialog-wrapper"]],decls:1,vars:3,consts:[[3,"images","currentImage","actions","imageDeleted","currentImageChanged","close"]],template:function(e,t){1&e&&(u["\u0275\u0275elementStart"](0,"app-image-viewer",0),u["\u0275\u0275listener"]("imageDeleted",(function(e){return t.deleteImage(e)}))("currentImageChanged",(function(e){return t.data.currentImage=e}))("close",(function(){return t.close()})),u["\u0275\u0275elementEnd"]()),2&e&&u["\u0275\u0275property"]("images",t.data.images)("currentImage",t.data.currentImage)("actions",t.actions)},directives:[j],encapsulation:2,changeDetection:0}),e}(),O=n("EFs6"),_=n("GQZI"),R=n("THg6"),B=n("hhBj"),D=n("wehj"),V=function(){function e(){}return e.prototype.transform=function(e){return e.replace(/images/gi,"thumbnails")},e.\u0275fac=function(t){return new(t||e)},e.\u0275pipe=u["\u0275\u0275definePipe"]({name:"thumbnail",type:e,pure:!0}),e}();function M(e,t){if(1&e){var n=u["\u0275\u0275getCurrentView"]();u["\u0275\u0275elementStart"](0,"app-selectable-card",4),u["\u0275\u0275listener"]("selected",(function(){u["\u0275\u0275restoreView"](n);var e=t.$implicit;return u["\u0275\u0275nextContext"](2).toggleSelect(e)}))("click",(function(){u["\u0275\u0275restoreView"](n);var e=t.$implicit;return u["\u0275\u0275nextContext"](2).imageClick(e.entity)})),u["\u0275\u0275element"](1,"img",5),u["\u0275\u0275pipe"](2,"thumbnail"),u["\u0275\u0275elementEnd"]()}if(2&e){var i=t.$implicit;u["\u0275\u0275property"]("isSelected",i.selected),u["\u0275\u0275advance"](1),u["\u0275\u0275propertyInterpolate"]("src",u["\u0275\u0275pipeBind1"](2,2,i.entity.fileURL),u["\u0275\u0275sanitizeUrl"])}}function N(e,t){if(1&e&&(u["\u0275\u0275elementStart"](0,"div",2),u["\u0275\u0275template"](1,M,3,4,"app-selectable-card",3),u["\u0275\u0275pipe"](2,"arrayslice"),u["\u0275\u0275pipe"](3,"async"),u["\u0275\u0275elementEnd"]()),2&e){var n=t.$implicit,i=u["\u0275\u0275nextContext"]();u["\u0275\u0275advance"](1),u["\u0275\u0275property"]("ngForOf",u["\u0275\u0275pipeBind3"](2,2,u["\u0275\u0275pipeBind1"](3,6,i.selectableEntities$),n,i.totalRows))("ngForTrackBy",i.trackById)}}var P=function(e){function t(t){var n=e.call(this,t)||this;return n.disableImageViewer=!1,n.totalRows=2,n.imageClicked=new u.EventEmitter,n.imageClick=function(e){n.disableImageViewer||n.selectableListPresenter.isEntitySelected(e.id)||n.imageClicked.emit(e)},n}return Object(a.b)(t,e),t.prototype.toggleSelect=function(t){var n=this;this.disableImageViewer=!0,e.prototype.toggleSelect.call(this,t),setTimeout((function(){return n.disableImageViewer=!1}),500)},t.prototype.trackById=function(e,t){return t.entity.id},t.\u0275fac=function(e){return new(e||t)(u["\u0275\u0275directiveInject"](d.c))},t.\u0275cmp=u["\u0275\u0275defineComponent"]({type:t,selectors:[["app-image-list"]],inputs:{totalRows:"totalRows"},outputs:{imageClicked:"imageClicked"},features:[u["\u0275\u0275ProvidersFeature"]([d.c]),u["\u0275\u0275InheritDefinitionFeature"]],decls:3,vars:3,consts:[[1,"entity-row"],["class","entity-column",4,"ngFor","ngForOf"],[1,"entity-column"],["selectedText","Bilde valgt","selectedIcon","check_circle",3,"isSelected","selected","click",4,"ngFor","ngForOf","ngForTrackBy"],["selectedText","Bilde valgt","selectedIcon","check_circle",3,"isSelected","selected","click"],["appImageErrorReloader","","alt","oppdragsbilde",1,"entity-card","fadeIn",3,"src"]],template:function(e,t){1&e&&(u["\u0275\u0275elementStart"](0,"div",0),u["\u0275\u0275template"](1,N,4,8,"div",1),u["\u0275\u0275pipe"](2,"arrayFromNumber"),u["\u0275\u0275elementEnd"]()),2&e&&(u["\u0275\u0275advance"](1),u["\u0275\u0275property"]("ngForOf",u["\u0275\u0275pipeBind1"](2,1,t.totalRows)))},directives:[x.k,_.a,R.a],pipes:[B.a,D.a,x.b,V],encapsulation:2,changeDetection:0}),t}(d.b),$=["imageList"];function L(e,t){if(1&e){var n=u["\u0275\u0275getCurrentView"]();u["\u0275\u0275elementStart"](0,"app-image-list",5,6),u["\u0275\u0275listener"]("selectionChanged",(function(e){return u["\u0275\u0275restoreView"](n),u["\u0275\u0275nextContext"]().currentSelections=e}))("imageClicked",(function(e){u["\u0275\u0275restoreView"](n);var i=t.$implicit;return u["\u0275\u0275nextContext"]().openImageViewer(e,i)})),u["\u0275\u0275pipe"](2,"async"),u["\u0275\u0275elementEnd"]()}if(2&e){var i=t.$implicit,a=u["\u0275\u0275nextContext"]();u["\u0275\u0275property"]("totalRows",u["\u0275\u0275pipeBind1"](2,2,a.isXs$)?2:4)("entities",i)}}function F(e,t){if(1&e){var n=u["\u0275\u0275getCurrentView"]();u["\u0275\u0275elementContainerStart"](0),u["\u0275\u0275elementStart"](1,"button",8),u["\u0275\u0275listener"]("click",(function(){u["\u0275\u0275restoreView"](n);var e=u["\u0275\u0275nextContext"](2);return e.openMailImageSheet(e.currentSelections)})),u["\u0275\u0275elementStart"](2,"mat-icon"),u["\u0275\u0275text"](3,"send"),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementStart"](4,"button",9),u["\u0275\u0275listener"]("click",(function(){u["\u0275\u0275restoreView"](n);var e=u["\u0275\u0275nextContext"](2);return e.openConfirmDeleteDialog(e.currentSelections)})),u["\u0275\u0275elementStart"](5,"mat-icon"),u["\u0275\u0275text"](6,"delete_forever"),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementContainerEnd"]()}}function T(e,t){if(1&e&&(u["\u0275\u0275elementContainerStart"](0),u["\u0275\u0275template"](1,F,7,0,"ng-container",7),u["\u0275\u0275elementContainerEnd"]()),2&e){var n=u["\u0275\u0275nextContext"]();u["\u0275\u0275advance"](1),u["\u0275\u0275property"]("ifRole",n.RolePresets.Authority)}}function H(e,t){if(1&e){var n=u["\u0275\u0275getCurrentView"]();u["\u0275\u0275elementStart"](0,"button",10),u["\u0275\u0275listener"]("click",(function(){return u["\u0275\u0275restoreView"](n),u["\u0275\u0275nextContext"](),u["\u0275\u0275reference"](5).click()})),u["\u0275\u0275elementStart"](1,"mat-icon"),u["\u0275\u0275text"](2,"camera_enhance"),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"]()}}var U=[{path:"",component:function(e){function t(t,n,i,a,o,c,l,m,u){var p=e.call(this)||this;return p.deviceInfoService=t,p.bottomSheet=n,p.dialog=i,p.notificationService=a,p.mainNavService=o,p.missionImageService=c,p.missionService=l,p.route=m,p.router=u,p.RolePresets=s.h,p.currentSelections=[],p.isXs$=p.deviceInfoService.isXs$,p.uploadImages=function(e){p.missionImageService.addImages$(p.missionId,e).subscribe((function(e){return p.notificationService.setNotification("Vellykket! "+e.length+" "+(e.length>1?"bilder":"bilde")+" lastet opp.")}))},p.deleteImages=function(e){p.missionImageService.deleteRange$(e).subscribe((function(t){p.imageList.clearSelections(),p.notificationService.setNotification("Vellykket! "+e.length+" "+(e.length>1?"bilder":"bilde")+" slettet.")}))},p.openConfirmDeleteDialog=function(e){p.dialog.open(d.a,{data:"Bekreft at du \xf8nsker \xe5 slette utvalgte bilder."}).afterClosed().pipe(Object(r.a)((function(e){return e}))).subscribe((function(t){return p.deleteImages(e)}))},p.openMailImageSheet=function(e){p.bottomSheet.open(h,{data:{toEmailPreset:p.mission.employer?p.mission.employer.email:null,ids:e}}).afterDismissed().pipe(Object(r.a)((function(e){return e}))).subscribe((function(e){return p.imageList.clearSelections()}))},p.updateMainNav=function(e){var t=p.mainNavService.getTopDefaultNavConfig();t.bottomSheetButtons=p.getBottomSheetButtons(e.map((function(e){return e.id}))),p.mainNavService.addTopNavConfig({default:t})},p.onBack=function(e){return p.router.navigate(["/oppdrag",e,"detaljer"])},p.getBottomSheetButtons=function(e){return[{icon:"send",text:"Send alle bilder",callback:p.openMailImageSheet,params:[e],allowedRoles:s.h.Authority}]},p.configureMainNav(p.missionId),p}return Object(a.b)(t,e),Object.defineProperty(t.prototype,"missionId",{get:function(){return+this.route.snapshot.paramMap.get("id")},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){var e=this;this.images$=this.missionImageService.getByMissionId$(this.missionId).pipe(Object(o.a)(this.updateMainNav)),this.missionService.getDetails$(this.missionId).pipe(Object(c.a)(this.unsubscribe)).subscribe((function(t){return e.mission=t}))},t.prototype.openImageViewer=function(e,t){this.dialog.open(E,{width:"100%",height:"100%",panelClass:"image_viewer_dialog",data:{currentImage:e,images:t}})},t.prototype.configureMainNav=function(e){this.mainNavService.addTopNavConfig({default:{title:"Bilder",backFn:this.onBack,backFnParams:[e]}})},t.\u0275fac=function(e){return new(e||t)(u["\u0275\u0275directiveInject"](p.i),u["\u0275\u0275directiveInject"](m.b),u["\u0275\u0275directiveInject"](b.b),u["\u0275\u0275directiveInject"](p.w),u["\u0275\u0275directiveInject"](p.p),u["\u0275\u0275directiveInject"](p.r),u["\u0275\u0275directiveInject"](p.t),u["\u0275\u0275directiveInject"](i.a),u["\u0275\u0275directiveInject"](i.b))},t.\u0275cmp=u["\u0275\u0275defineComponent"]({type:t,selectors:[["app-mission-image-list"]],viewQuery:function(e,t){var n;1&e&&u["\u0275\u0275viewQuery"]($,!0),2&e&&u["\u0275\u0275queryRefresh"](n=u["\u0275\u0275loadQuery"]())&&(t.imageList=n.first)},features:[u["\u0275\u0275InheritDefinitionFeature"]],decls:6,vars:5,consts:[[3,"totalRows","entities","selectionChanged","imageClicked",4,"ngIf"],[4,"ngIf"],["mat-fab","","aria-label","ny","class","action_fab",3,"click",4,"ifRole"],["type","file","multiple","",2,"display","none",3,"change"],["imageInput",""],[3,"totalRows","entities","selectionChanged","imageClicked"],["imageList",""],[4,"ifRole"],["mat-fab","","aria-label","ny",1,"action_fab_2",3,"click"],["mat-fab","","aria-label","ny",1,"action_fab_3","bg-warn",3,"click"],["mat-fab","","aria-label","ny",1,"action_fab",3,"click"]],template:function(e,t){1&e&&(u["\u0275\u0275template"](0,L,3,4,"app-image-list",0),u["\u0275\u0275pipe"](1,"async"),u["\u0275\u0275template"](2,T,2,1,"ng-container",1),u["\u0275\u0275template"](3,H,3,0,"button",2),u["\u0275\u0275elementStart"](4,"input",3,4),u["\u0275\u0275listener"]("change",(function(e){return t.uploadImages(e.target.files)})),u["\u0275\u0275elementEnd"]()),2&e&&(u["\u0275\u0275property"]("ngIf",u["\u0275\u0275pipeBind1"](1,3,t.images$)),u["\u0275\u0275advance"](2),u["\u0275\u0275property"]("ngIf",t.currentSelections.length>0),u["\u0275\u0275advance"](1),u["\u0275\u0275property"]("ifRole",t.RolePresets.Internal))},directives:[x.l,O.a,P,S.b,C.a],pipes:[x.b],encapsulation:2,changeDetection:0}),t}(l.a)}],A=function(){function e(){}return e.\u0275mod=u["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=u["\u0275\u0275defineInjector"]({factory:function(t){return new(t||e)},imports:[[i.f.forChild(U)],i.f]}),e}(),J=n("PCNd"),Q=function(){function e(){}return e.\u0275mod=u["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=u["\u0275\u0275defineInjector"]({factory:function(t){return new(t||e)},imports:[[J.a,A]]}),e}()}}]);