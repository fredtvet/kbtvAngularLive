(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{tnMk:function(e,t,n){"use strict";n.r(t),n.d(t,"MissionModule",(function(){return W}));var i=n("DUip"),r=n("mrSG"),o=n("26FU"),a=n("15JJ"),s=n("67Y/"),c=n("k5Aa"),u=n("TYT/"),l=n("dJ3e"),d=n("ea4N"),p=n("Valr"),m=n("6tST"),f=n("h/AT"),h=n("uLXW"),v=n("K9Ia"),g=n("1eh6"),b=n("Gi3i"),I=n("ad02"),S=n("xMyE"),k=n("ny24"),y=function(e){function t(){var t=e.call(this)||this;return t.debounceTime=400,t.inputChanged=new u.EventEmitter,t.inputUpdated=new v.a,t.inputUpdated.asObservable().pipe(Object(b.a)(t.debounceTime),Object(I.a)(),Object(S.a)((function(e){return t.inputChanged.emit(e)})),Object(k.a)(t.unsubscribe)).subscribe(),t}return Object(r.b)(t,e),t.prototype.onKeyUp=function(e){this.onInputChange(e.target.value)},t.prototype.onInputChange=function(e){this.inputUpdated.next(e)},t.\u0275fac=function(e){return new(e||t)},t.\u0275dir=u["\u0275\u0275defineDirective"]({type:t,selectors:[["","appInputListener",""]],hostBindings:function(e,t){1&e&&u["\u0275\u0275listener"]("keyup",(function(e){return t.onKeyUp(e)}))},inputs:{debounceTime:"debounceTime"},outputs:{inputChanged:"inputChanged"},features:[u["\u0275\u0275InheritDefinitionFeature"]]}),t}(g.a),w=n("pdUi"),M=n("Pohz"),j=n("XehU"),x=n("p+mS"),C=n("GsDI");function N(e,t){1&e&&(u["\u0275\u0275elementStart"](0,"p",6),u["\u0275\u0275text"](1,"Fant ingen oppdrag"),u["\u0275\u0275elementEnd"]())}var O=function(e){return["/oppdrag",e,"detaljer"]};function F(e,t){if(1&e&&u["\u0275\u0275element"](0,"app-list-card",7),2&e){var n=t.$implicit;u["\u0275\u0275property"]("endIcon",n.finished?"check":"chevron_right")("text","("+n.id+") "+n.address)("routerLink",u["\u0275\u0275pureFunction1"](3,O,n.id))}}function L(e,t){if(1&e){var n=u["\u0275\u0275getCurrentView"]();u["\u0275\u0275elementStart"](0,"button",8),u["\u0275\u0275listener"]("click",(function(){return u["\u0275\u0275restoreView"](n),u["\u0275\u0275nextContext"]().openMissionForm()})),u["\u0275\u0275elementStart"](1,"mat-icon"),u["\u0275\u0275text"](2,"add"),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"]()}}var B=function(e,t){return[e,t]},T=function(){function e(e,t,n){var i=this;this._bottomSheet=e,this.router=t,this.route=n,this.Roles=c.f,this.missions=[],this.title="Oppdrag",this.search=new u.EventEmitter,this.onSearch=function(e){return i.search.emit(e)},this.openMissionForm=function(){return i.router.navigate(["ny"],{relativeTo:i.route})},this.trackByFn=function(e,t){return t.id}}return e.prototype.ngOnInit=function(){},e.\u0275fac=function(t){return new(t||e)(u["\u0275\u0275directiveInject"](f.b),u["\u0275\u0275directiveInject"](i.b),u["\u0275\u0275directiveInject"](i.a))},e.\u0275cmp=u["\u0275\u0275defineComponent"]({type:e,selectors:[["app-mission-list-view"]],inputs:{missions:"missions",title:"title"},outputs:{search:"search"},decls:6,vars:7,consts:[["fxLayout","column","fxLayoutAlign","start stretch",1,"h-100","pl-2","pr-2","max-width",2,"overflow","hidden"],["appInputListener","","placeholder","S\xf8k med adresse eller id",1,"mt-2","mb-2","p-2","pl-3","mat-elevation-z2","fadeInDown",2,"background","white","border","none","border-radius","10px",3,"inputChanged"],["class","m-2",4,"ngIf"],["itemSize","60","maxBufferPx","800","minBufferPx","800","fxFlex",""],["startIcon","home_work",3,"endIcon","text","routerLink",4,"cdkVirtualFor","cdkVirtualForOf","cdkVirtualForTrackBy"],["mat-fab","","aria-label","ny","class","action_fab",3,"click",4,"ifRole"],[1,"m-2"],["startIcon","home_work",3,"endIcon","text","routerLink"],["mat-fab","","aria-label","ny",1,"action_fab",3,"click"]],template:function(e,t){1&e&&(u["\u0275\u0275elementStart"](0,"div",0),u["\u0275\u0275elementStart"](1,"input",1),u["\u0275\u0275listener"]("inputChanged",(function(e){return t.onSearch(e)})),u["\u0275\u0275elementEnd"](),u["\u0275\u0275template"](2,N,2,0,"p",2),u["\u0275\u0275elementStart"](3,"cdk-virtual-scroll-viewport",3),u["\u0275\u0275template"](4,F,1,5,"app-list-card",4),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275template"](5,L,3,0,"button",5)),2&e&&(u["\u0275\u0275advance"](2),u["\u0275\u0275property"]("ngIf",null==t.missions||0==t.missions.length),u["\u0275\u0275advance"](2),u["\u0275\u0275property"]("cdkVirtualForOf",t.missions)("cdkVirtualForTrackBy",t.trackByFn),u["\u0275\u0275advance"](1),u["\u0275\u0275property"]("ifRole",u["\u0275\u0275pureFunction2"](4,B,t.Roles.Leder,t.Roles.Mellomleder)))},directives:[h.c,h.b,y,p.l,w.e,w.a,h.a,w.d,M.a,j.a,i.c,x.b,C.a],encapsulation:2,data:{animation:[m.a]},changeDetection:0}),e}(),D=n("RHY+");function E(e,t){if(1&e){var n=u["\u0275\u0275getCurrentView"]();u["\u0275\u0275elementStart"](0,"app-mission-list-view",1),u["\u0275\u0275listener"]("search",(function(e){return u["\u0275\u0275restoreView"](n),u["\u0275\u0275nextContext"]().searchMissionList(e)})),u["\u0275\u0275pipe"](1,"sortByDate"),u["\u0275\u0275elementEnd"]()}if(2&e){var i=t.$implicit;u["\u0275\u0275property"]("missions",u["\u0275\u0275pipeBind3"](1,1,i.missions,null!=i.pageInfo&&i.pageInfo.historic?"lastVisited":"updatedAt","desc"))}}var V=function(){function e(e,t,n){var i=this;this.mainNavService=e,this.missionService=t,this.dialog=n,this.Roles=c.f,this.pageInfoSubject=new o.a({searchString:"",showFinishedMissions:!1,historic:!1}),this.searchMissionList=function(e){var t=Object(r.a)({},i.pageInfoSubject.value);t.searchString=e,i.pageInfoSubject.next(t)},this.toggleFinishedMissions=function(){var e=Object(r.a)({},i.pageInfoSubject.value);e.showFinishedMissions=!e.showFinishedMissions,i.pageInfoSubject.next(e);var t="check_box_outline_blank";e.showFinishedMissions&&(t="check_box");var n=i.mainNavService.getTopDefaultNavConfig();n.bottomSheetButtons[0].icon=t,i.mainNavService.addTopNavConfig({default:n})},this.toggleHistoricOrder=function(){var e=Object(r.a)({},i.pageInfoSubject.value);e.historic=!e.historic,i.pageInfoSubject.next(e);var t="color-background";e.historic&&(t="color-accent");var n=i.mainNavService.getTopDefaultNavConfig();n.buttons[0].colorClass=t,i.mainNavService.addTopNavConfig({default:n})},this.configureMainNav()}return e.prototype.ngOnInit=function(){var e=this;this.vm$=this.pageInfoSubject.pipe(Object(a.a)((function(t){return e.missionService.getBy$((function(n){return e.filterMission(n,t)})).pipe(Object(s.a)((function(e){return{missions:e,pageInfo:t}})))})))},e.prototype.filterMission=function(e,t){var n=e.finished==t.showFinishedMissions;n=n&&(!t.searchString||null==t.searchString||e.address.toLowerCase().includes(t.searchString.toLowerCase()));var i=+t.searchString;return isNaN(i)||(n=n||e.id===i),n},e.prototype.configureMainNav=function(){var e={title:"Oppdrag"};e.buttons=[{icon:"history",colorClass:"color-background",aria:"Historisk visning",callback:this.toggleHistoricOrder}],e.bottomSheetButtons=[{text:"Vis ferdige oppdrag",icon:"check_box_outline_blank",callback:this.toggleFinishedMissions}],this.mainNavService.addTopNavConfig({default:e})},e.\u0275fac=function(t){return new(t||e)(u["\u0275\u0275directiveInject"](l.o),u["\u0275\u0275directiveInject"](l.s),u["\u0275\u0275directiveInject"](d.b))},e.\u0275cmp=u["\u0275\u0275defineComponent"]({type:e,selectors:[["app-mission-list"]],decls:3,vars:3,consts:[[3,"missions","search",4,"ngIf"],[3,"missions","search"]],template:function(e,t){1&e&&(u["\u0275\u0275template"](0,E,2,5,"app-mission-list-view",0),u["\u0275\u0275pipe"](1,"async"),u["\u0275\u0275element"](2,"router-outlet")),2&e&&u["\u0275\u0275property"]("ngIf",u["\u0275\u0275pipeBind1"](1,1,t.vm$))},directives:[p.l,i.g,T],pipes:[p.b,D.a],encapsulation:2,changeDetection:0}),e}(),R=n("1ua0"),_=n("VnD/"),$=n("dzgT"),U=n("aBAV"),A=n("MqYC"),P=function(e){return["/oppdrag",e,"bilder"]},z=function(e){return["/oppdrag",e,"dokumenter"]},J=function(e){return["/oppdrag",e,"notater"]};function H(e,t){if(1&e&&(u["\u0275\u0275elementStart"](0,"div",1),u["\u0275\u0275elementStart"](1,"mat-grid-list",2),u["\u0275\u0275elementStart"](2,"a",3),u["\u0275\u0275elementStart"](3,"mat-grid-tile",4),u["\u0275\u0275elementStart"](4,"span",5),u["\u0275\u0275elementStart"](5,"mat-icon",6),u["\u0275\u0275text"](6,"phone"),u["\u0275\u0275elementEnd"](),u["\u0275\u0275element"](7,"br"),u["\u0275\u0275elementStart"](8,"span"),u["\u0275\u0275text"](9),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementStart"](10,"a",7),u["\u0275\u0275elementStart"](11,"mat-grid-tile",4),u["\u0275\u0275elementStart"](12,"span",5),u["\u0275\u0275elementStart"](13,"mat-icon",6),u["\u0275\u0275text"](14,"directions_car"),u["\u0275\u0275elementEnd"](),u["\u0275\u0275element"](15,"br"),u["\u0275\u0275elementStart"](16,"span"),u["\u0275\u0275text"](17,"Veibeskrivelse"),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275element"](18,"app-list-card",8),u["\u0275\u0275element"](19,"app-list-card",9),u["\u0275\u0275element"](20,"app-list-card",10),u["\u0275\u0275elementEnd"]()),2&e){var n=u["\u0275\u0275nextContext"]();u["\u0275\u0275advance"](2),u["\u0275\u0275propertyInterpolate1"]("href","tel:",n.vm.mission.phoneNumber,"",u["\u0275\u0275sanitizeUrl"]),u["\u0275\u0275advance"](7),u["\u0275\u0275textInterpolate1"]("",n.vm.mission.phoneNumber||"N/A"," "),u["\u0275\u0275advance"](1),u["\u0275\u0275propertyInterpolate1"]("href","https://www.google.com/maps/dir/?api=1&destination=",n.vm.mission.address,"&travelmode=driving",u["\u0275\u0275sanitizeUrl"]),u["\u0275\u0275advance"](8),u["\u0275\u0275property"]("routerLink",u["\u0275\u0275pureFunction1"](6,P,n.vm.mission.id)),u["\u0275\u0275advance"](1),u["\u0275\u0275property"]("routerLink",u["\u0275\u0275pureFunction1"](8,z,n.vm.mission.id)),u["\u0275\u0275advance"](1),u["\u0275\u0275property"]("routerLink",u["\u0275\u0275pureFunction1"](10,J,n.vm.mission.id))}}var X=function(){function e(){this.Roles=c.f}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=u["\u0275\u0275defineComponent"]({type:e,selectors:[["app-mission-details-view"]],inputs:{vm:"vm"},decls:1,vars:1,consts:[["class","p-2 max-width",4,"ngIf"],[1,"p-2","max-width"],["cols","2","rowHeight","3:2","gutterSize","5",1,"mat-subheading-2","mb-2"],[3,"href"],["matRipple","",1,"mat-elevation-z2","bg-foreground"],[1,"text-center"],[1,"scale-150"],["target","_blank",3,"href"],["text","Bilder","startIcon","photo_library",3,"routerLink"],["text","Dokumenter","startIcon","folder",3,"routerLink"],["text","Notater","startIcon","rate_review",3,"routerLink"]],template:function(e,t){1&e&&u["\u0275\u0275template"](0,H,21,12,"div",0),2&e&&u["\u0275\u0275property"]("ngIf",t.vm)},directives:[p.l,U.a,U.c,A.n,C.a,j.a,i.c],encapsulation:2,changeDetection:0}),e}();function Y(e,t){1&e&&u["\u0275\u0275element"](0,"app-mission-details-view",1),2&e&&u["\u0275\u0275property"]("vm",t.$implicit)}var q=[{path:"",component:V,canActivate:[l.d],data:{animation:"MissionList"},children:[{path:"ny",loadChildren:function(){return n.e(3).then(n.bind(null,"4XuV")).then((function(e){return e.MissionFormModule}))}}]},{path:":id/detaljer",component:function(){function e(e,t,n,i,r,o,a,s,u){var l=this;this.mainNavService=e,this.missionService=t,this.missionImageService=n,this.missionDocumentService=i,this.missionNoteService=r,this.notificationService=o,this.route=a,this.router=s,this.dialog=u,this.RolePresets=c.e,this.Roles=c.f,this.uploadImages=function(e){l.missionImageService.addImages$(e.missionId,e.files).subscribe((function(e){return l.notificationService.setNotification("Vellykket! "+e.length+" "+(e.length>1?"bilder":"bilde")+" lastet opp.")}))},this.deleteMission=function(e){l.onBack(),l.missionService.delete$(e).pipe(Object(_.a)((function(e){return e}))).subscribe((function(e){return l.notificationService.setNotification("Vellykket! Oppdrag slettet.")}))},this.openMissionForm=function(e){return l.router.navigate(["rediger"],{relativeTo:l.route,queryParams:{idPreset:e}})},this.openDeleteMissionDialog=function(e){l.dialog.open(R.b,{data:"Bekreft at du \xf8nsker \xe5 slette oppdraget."}).afterClosed().pipe(Object(_.a)((function(e){return e}))).subscribe((function(t){return l.deleteMission(e)}))},this.goToTimesheets=function(e){return l.router.navigate(["timer/liste",{returnRoute:l.router.url,missionId:JSON.stringify(e)}])},this.onBack=function(){return l.router.navigate(["/oppdrag"])}}return e.prototype.ngOnInit=function(){var e=this,t=+this.route.snapshot.paramMap.get("id"),n=this.missionService.getDetails$(t),i=this.missionImageService.getByMissionId$(t).pipe(Object(s.a)((function(e){return e.length}))),o=this.missionDocumentService.getByMissionId$(t).pipe(Object(s.a)((function(e){return e.length}))),a=this.missionNoteService.getByMissionId$(t).pipe(Object(s.a)((function(e){return e.length})));this.vm$=Object($.a)(n,i,o,a).pipe(Object(s.a)((function(e){var t=Object(r.c)(e,4);return{mission:t[0],imageCount:t[1],documentCount:t[2],noteCount:t[3]}})),Object(S.a)((function(t){return e.configureMainNav(t.mission)})))},e.prototype.configureMainNav=function(e){var t={title:e.address.split(",").filter((function(e){return"norge"!==e.toLowerCase().replace(/\s/g,"")})),subTitle:e.finished?"Oppdrag ferdig!":"",subIcon:e.finished?"check":"",imgSrc:e.imageURL,backFn:this.onBack};t.bottomSheetButtons=[{text:"Registrer timer",icon:"timer",callback:this.goToTimesheets,params:[e],allowedRoles:c.e.Internal},{text:"Rediger",icon:"edit",callback:this.openMissionForm,params:[e.id],allowedRoles:[c.f.Leder]},{text:"Slett",icon:"delete_forever",callback:this.openDeleteMissionDialog,params:[e.id],allowedRoles:[c.f.Leder]}],this.mainNavService.addTopNavConfig({detail:t})},e.\u0275fac=function(t){return new(t||e)(u["\u0275\u0275directiveInject"](l.o),u["\u0275\u0275directiveInject"](l.s),u["\u0275\u0275directiveInject"](l.q),u["\u0275\u0275directiveInject"](l.p),u["\u0275\u0275directiveInject"](l.r),u["\u0275\u0275directiveInject"](l.v),u["\u0275\u0275directiveInject"](i.a),u["\u0275\u0275directiveInject"](i.b),u["\u0275\u0275directiveInject"](d.b))},e.\u0275cmp=u["\u0275\u0275defineComponent"]({type:e,selectors:[["app-mission-details"]],decls:3,vars:3,consts:[[3,"vm",4,"ngIf"],[3,"vm"]],template:function(e,t){1&e&&(u["\u0275\u0275template"](0,Y,1,1,"app-mission-details-view",0),u["\u0275\u0275pipe"](1,"async"),u["\u0275\u0275element"](2,"router-outlet")),2&e&&u["\u0275\u0275property"]("ngIf",u["\u0275\u0275pipeBind1"](1,1,t.vm$))},directives:[p.l,i.g,X],pipes:[p.b],encapsulation:2,changeDetection:0}),e}(),canActivate:[l.d],data:{animation:"MissionDetails"},children:[{path:"rediger",loadChildren:function(){return n.e(3).then(n.bind(null,"4XuV")).then((function(e){return e.MissionFormModule}))}}]},{path:":id/bilder",loadChildren:function(){return Promise.all([n.e(0),n.e(13)]).then(n.bind(null,"skTp")).then((function(e){return e.MissionImageListModule}))},canActivate:[l.d],data:{animation:"MissionImages"}},{path:":id/dokumenter",loadChildren:function(){return Promise.all([n.e(0),n.e(12)]).then(n.bind(null,"PvB8")).then((function(e){return e.MissionDocumentListModule}))},canActivate:[l.d],data:{animation:"MissionDocuments"}},{path:":id/notater",loadChildren:function(){return n.e(15).then(n.bind(null,"QoWm")).then((function(e){return e.MissionNoteListModule}))},canActivate:[l.d],data:{animation:"MissionNotes"}}],G=function(){function e(){}return e.\u0275mod=u["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=u["\u0275\u0275defineInjector"]({factory:function(t){return new(t||e)},imports:[[i.f.forChild(q)],i.f]}),e}(),K=n("PCNd"),W=function(){function e(){}return e.\u0275mod=u["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=u["\u0275\u0275defineInjector"]({factory:function(t){return new(t||e)},providers:[p.e],imports:[[K.a,G]]}),e}()}}]);